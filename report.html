<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Step 3 Â· äººæ ¼æµ‹è¯„æŠ¥å‘Šï¼ˆç‚«é…·ç‰ˆï¼‰</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3"></script>
<style>
  :root{
    --bg:#0b1020; --bg2:#0e1530; --card:#0f1a3a; --muted:#99a1b3; --text:#e8ecff;
    --primary:#7c9bff; --accent:#52e3c2; --warm:#f59f0b; --danger:#ff5c9a; --good:#4ade80;
    --ring: rgba(124,155,255,.35); --glass: rgba(255,255,255,.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:"Inter","HarmonyOS Sans","Noto Sans SC",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:
      radial-gradient(1200px 800px at -10% -10%, #1b2a6b 0%, transparent 60%),
      radial-gradient(1000px 800px at 110% 0%, #1c3d4f 0%, transparent 55%),
      radial-gradient(1200px 900px at 50% 120%, #251b5a 0%, transparent 60%),
      linear-gradient(180deg, #070b18 0%, #0b1020 100%);
    background-attachment: fixed;
  }
  .container{max-width:1280px;margin:0 auto;padding:18px}
  .heading{display:flex;justify-content:space-between;align-items:center;gap:10px;margin:10px 0 18px;}
  .title{
    font-size:28px;font-weight:800;letter-spacing:.3px;
    background:linear-gradient(90deg,#a0b8ff 0%,#52e3c2 40%,#f7b500 80%);
    -webkit-background-clip:text;background-clip:text;color:transparent;
    filter: drop-shadow(0 10px 30px rgba(124,155,255,.25));
  }
  .nav{display:flex;gap:10px; z-index: 10; position: relative;}
  .btn{display:inline-flex;align-items:center;justify-content:center;text-decoration:none;}
  .btn:link,.btn:visited{color:inherit;text-decoration:none}
  .btn{
    padding:12px 16px;border:1px solid rgba(255,255,255,.12);border-radius:12px;
    color:var(--text);background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    cursor:pointer; backdrop-filter: blur(8px); font-size:15px; min-height:42px;
  }
  .btn:hover{box-shadow:0 0 0 4px var(--ring) inset}
  .btn.primary{border-color:rgba(124,155,255,.3); background:linear-gradient(180deg, rgba(124,155,255,.25), rgba(124,155,255,.06));}

  .grid{display:grid;gap:16px}
  .grid.g2{grid-template-columns:1fr 1fr}
  .grid.g3{grid-template-columns:repeat(3,1fr)}
  @media (max-width:1020px){ .grid.g2,.grid.g3{grid-template-columns:1fr} }

  .card{
    position:relative;overflow:hidden;border-radius:18px;padding:16px;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.12);
    box-shadow: 0 12px 24px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.06) inset;
  }
  .card::before{
    content:""; position:absolute; inset:-1px;
    background:
      radial-gradient(400px 160px at 10% -10%, rgba(124,155,255,.18), transparent 70%),
      radial-gradient(400px 160px at 110% 10%, rgba(82,227,194,.18), transparent 70%);
    z-index:0; pointer-events:none;
  }
  .card > *{position:relative; z-index:1}
  .card h3{margin:0 0 8px; font-size:16px; font-weight:700; letter-spacing:.2px}
  .sub{color:var(--muted); font-size:12px}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .chip{padding:6px 10px; border-radius:999px; font-size:12px; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.12);}
  .kv{display:flex;gap:14px;flex-wrap:wrap}
  .kv .k{color:var(--muted);font-size:12px}
  .kv .v{font-weight:700}
  .compare{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .badge{padding:4px 8px;border-radius:10px;font-size:12px;border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));}
  .badge.good{border-color:rgba(82,227,194,.35); color:#befae7}
  .badge.warn{border-color:rgba(247,181,0,.35); color:#ffe6a1}
  .badge.bad{border-color:rgba(255,92,154,.4); color:#ffc4db}
  .chart-wrap{position:relative;height:340px}
  .row-radar{display:grid;grid-template-columns:1fr 1fr; gap:16px}
  @media (max-width:1020px){ .row-radar{grid-template-columns:1fr} }
  .chart-wrap.radar{height:420px}
  .footer{opacity:.75; text-align:center; font-size:12px; margin:20px 0}
  .chart{ position:relative; height:clamp(300px,56vh,640px) }
</style>
</head>
<body>
  <div class="container">
    <div class="heading">
      <div class="title">ğŸ“Š äººæ ¼æµ‹è¯„æŠ¥å‘Š Â· ç‚«é…·ç‰ˆ</div>
      <div class="nav" style="pointer-events:auto">
        <button class="btn" onclick="location.href='step1.html'">â† ä¸Šä¸€æ­¥</button>
        <button class="btn" onclick="location.href='step2.html'">è¿”å›æ ‡ç­¾</button>
        <a class="btn" href="dashboard.html" role="button" tabindex="0">æŸ¥çœ‹ Dashboard</a>
        <button class="btn primary" id="btnDownload">ä¸‹è½½ PNG</button>
      </div>
    </div>

    <!-- é¡¶éƒ¨æ¦‚è§ˆ -->
    <div class="grid g3">
      <div class="card" id="cardZodiac">
        <h3>ğŸŒŸ æ˜Ÿåº§ä¸äº”è¡Œ</h3>
        <div class="kv">
          <div><span class="k">æ˜Ÿåº§</span> <span class="v" id="zodiacName">â€”</span></div>
          <div><span class="k">å››è±¡</span> <span class="v" id="zodiacElem">â€”</span></div>
          <div><span class="k">äº”è¡Œ</span> <span class="v" id="zodiacFive">â€”</span></div>
        </div>
        <div class="chips" id="zodiacTags"></div>
        <div class="chart-wrap" style="margin-top:10px"><canvas id="barZodiac"></canvas></div>
      </div>

      <div class="card">
        <h3>ğŸª å››æ¶²è´¨å€¾å‘åˆ†å¸ƒï¼ˆStep1 è‡ªè¯„ï¼‰</h3>
        <div class="compare" id="tempCompareBadge"></div>
        <div class="chart-wrap"><canvas id="barTemperament"></canvas></div>
      </div>

      <div class="card">
        <h3>ğŸ“Š åŸºç¡€äººæ ¼ç‰¹è´¨ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰</h3>
        <div class="compare" id="big5DeltaBadge"></div>
        <div class="chart-wrap"><canvas id="barBig5"></canvas></div>
      </div>
    </div>

    <!-- ä¸‰ç¯é›·è¾¾ï¼šç»“æ„ / ç”Ÿæ€ / æ½œåŠ›ï¼ˆæ¥è‡ª Dashboard åˆæˆç»“æœï¼‰ -->
    <div class="card" style="margin-top:16px">
      <h3>ğŸŒ€ ä¸‰ç¯é›·è¾¾ï¼šç»“æ„ â†’ ç”Ÿæ€ï¼ˆèšåˆï¼‰ â†’ æ½œåŠ›ï¼ˆåªè¯»ï¼‰</h3>
      <div class="sub">æœ¬å›¾ç›´æ¥è¯»å– Dashboard çš„åˆæˆç»“æœï¼šä¸åœ¨æŠ¥å‘Šå†…é‡ç®—ï¼Œç¡®ä¿å£å¾„ä¸€è‡´ï¼›ç”Ÿæ€16è½´å·²æŒ‰å›ºå®šæ˜ å°„èšåˆä¸º8ç»´ã€‚</div>
      <div class="chart-wrap radar"><canvas id="radarSEP"></canvas></div>
    </div>

    <!-- ä¸¤å¼ é›·è¾¾å¹¶æ’ -->
    <div class="row-radar">
      <div class="card">
        <h3>ğŸ§­ å¤§äº”äººæ ¼å¯¹æ¯”é›·è¾¾ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰</h3>
        <div class="chart-wrap radar"><canvas id="radarBig5"></canvas></div>
      </div>
      <div class="card">
        <h3>âš–ï¸ å››æ¶²è´¨å¯¹æ¯”é›·è¾¾ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰</h3>
        <div class="chart-wrap radar"><canvas id="radarTemperament"></canvas></div>
      </div>
    </div>

    <div class="footer">Â© äººæ ¼æˆé•¿ç«‹ä½“æ¨¡æ‹Ÿå™¨ | è§†è§‰æ¨¡å¼ï¼šNeonÂ·GlassMorph | v1.1</div>
  </div>

<script>
/** ==================== æ•°æ®è¯»å–ä¸å…œåº• ==================== **/
const LS = (k, d=null) => {
  try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : (typeof d==="string"?d:d); }
  catch(e){ return (typeof d==="string"?d:d); }
};
const L = (k, d=null) => localStorage.getItem(k) ?? d;

/* â€”â€” Step1 â€”â€” */
const zodiac = L('zodiac', "æœªå¡«å†™");
const zodiacElement = L('zodiacElement', "") || L('step1.zodiacElement', "");
const fiveElement   = L('fiveElement', "")   || L('step1.fiveElement', "");
const selfBig5      = LS('step1.big5', LS('selfScores', [50,50,50,50,50]));
const selfTemp      = LS('step1.temp', LS('temperamentSelf', {å¤šè¡€è´¨:25,èƒ†æ±è´¨:25,æŠ‘éƒè´¨:25,ç²˜æ¶²è´¨:25}));

/* â€”â€” Step2 â€”â€” */
const envBig5_raw   = LS('step2.big5_env', LS('envScores', [50,50,50,50,50]));
const envTemp_raw   = LS('step2.temp_env', LS('temperamentEnv', {å¤šè¡€è´¨:25,èƒ†æ±è´¨:25,æŠ‘éƒè´¨:25,ç²˜æ¶²è´¨:25}));
const struct_tags   = LS('step2.struct_from_tags', Array(8).fill(50));
const eco_tags16    = LS('step2.eco_from_tags',   Array(16).fill(50));

/* â€”â€” Step3 â€”â€” */
const Wb5           = LS('step3.weights.big5', [0,0,0,0,0]);
const Wtemp         = LS('step3.weights.temp', {å¤šè¡€è´¨:0,èƒ†æ±è´¨:0,æŠ‘éƒè´¨:0,ç²˜æ¶²è´¨:0});
const reliability   = Math.max(0, Math.min(1, Number(localStorage.getItem('step3.reliability') ?? 0.7)));
const struct_s3     = LS('step3.struct_from_step3', Array(8).fill(50));
const eco_s3_16     = LS('step3.eco_from_step3',    Array(16).fill(50));

/* â€”â€” Dashboard åˆæˆç»“æœï¼ˆåªè¯»ï¼‰ â€”â€” */
const struct8_final = LS('dash.struct8', Array(8).fill(50));
const eco16_final   = LS('dash.eco16',   Array(16).fill(50));
const potential8    = LS('dash.potential8', Array(8).fill(55));
const extremeMode   = JSON.parse(localStorage.getItem('dash.extreme') ?? 'false');

/** ==================== çº åèåˆï¼šBig5 / Temp ==================== **/
const clamp01 = (x)=> Math.max(0, Math.min(100, x));
const mixBig5 = (() => {
  const out_env = [];
  for(let i=0;i<5;i++){
    const S = Number(selfBig5[i]||0);
    const E0= Number(envBig5_raw[i]||0);
    const w = Number(Wb5[i]||0);
    const env = clamp01( (0.70+0.20*reliability)*E0 + (0.30-0.20*reliability)*S + w );
    out_env.push(env);
  }
  return { self:selfBig5.map(Number), env:out_env };
})();

const mixTemp = (() => {
  const keys = ["å¤šè¡€è´¨","èƒ†æ±è´¨","æŠ‘éƒè´¨","ç²˜æ¶²è´¨"];
  const out = {self:[], env:[]};
  keys.forEach(k=>{
    const S = Number(selfTemp[k]||0);
    const E0= Number(envTemp_raw[k]||0);
    const w = Number(Wtemp[k]||0);
    const env= clamp01( (0.70+0.20*reliability)*E0 + (0.30-0.20*reliability)*S + w );
    out.self.push(S); out.env.push(env);
  });
  out.labels = keys;
  return out;
})();

/** ==================== æ˜Ÿåº§æ ‡ç­¾åº“ & äº”è¡Œä¼°ç®— ==================== **/
const ZODIAC_TAGS = {
  "ç™½ç¾Šåº§":["è¡ŒåŠ¨åŠ›","ç›´ç‡","ç«äº‰","ç«å…ƒç´ "],
  "é‡‘ç‰›åº§":["ç¨³å¥","æ„Ÿå®˜","è€å¿ƒ","åœŸå…ƒç´ "],
  "åŒå­åº§":["å¥½å¥‡","è¡¨è¾¾","å¤šå˜","é£å…ƒç´ "],
  "å·¨èŸ¹åº§":["å…±æƒ…","å®ˆæŠ¤","æ•æ„Ÿ","æ°´å…ƒç´ "],
  "ç‹®å­åº§":["è‡ªä¿¡","èˆå°æ„Ÿ","é¢†å¯¼","ç«å…ƒç´ "],
  "å¤„å¥³åº§":["ç»†è‡´","å®Œç¾","æœåŠ¡","åœŸå…ƒç´ "],
  "å¤©ç§¤åº§":["å¹³è¡¡","å®¡ç¾","ç¤¾äº¤","é£å…ƒç´ "],
  "å¤©èåº§":["æ·±åº¦","æ„å¿—","æ´å¯Ÿ","æ°´å…ƒç´ "],
  "å°„æ‰‹åº§":["æ¢ç´¢","è‡ªç”±","ä¹è§‚","ç«å…ƒç´ "],
  "æ‘©ç¾¯åº§":["è´£ä»»","é•¿æœŸ","ç»“æ„","åœŸå…ƒç´ "],
  "æ°´ç“¶åº§":["åˆ›æ–°","ç‹¬ç«‹","ç†æ€§","é£å…ƒç´ "],
  "åŒé±¼åº§":["æƒ³è±¡","å…±æƒ…","æµªæ¼«","æ°´å…ƒç´ "],
  "æœªå¡«å†™":["â€”"]
};
document.getElementById('zodiacName').textContent = zodiac;
document.getElementById('zodiacElem').textContent = zodiacElement || "â€”";
document.getElementById('zodiacFive').textContent = fiveElement || "â€”";
(ZODIAC_TAGS[zodiac]||["â€”"]).forEach(t=>{
  const s=document.createElement('span'); s.className='chip'; s.textContent=t;
  document.getElementById('zodiacTags').appendChild(s);
});
function buildZodiacScore(){
  const base = {ç«:25,åœŸ:25,é£:25,æ°´:25};
  if(zodiacElement){ base[zodiacElement] = (base[zodiacElement]||0) + 10; downOthers(base, zodiacElement, 10); }
  const mapFive = {æœ¨:"é£",ç«:"ç«",åœŸ:"åœŸ",é‡‘:"é£",æ°´:"æ°´"};
  if(fiveElement && mapFive[fiveElement]){
    const t = mapFive[fiveElement];
    base[t] = (base[t]||0) + 8; downOthers(base, t, 8);
  }
  const sum = Object.values(base).reduce((a,b)=>a+b,0);
  const out = {}; Object.keys(base).forEach(k=> out[k] = Math.round(base[k]/sum*100));
  return out;
  function downOthers(obj, keep, delta){
    Object.keys(obj).filter(k=>k!==keep).forEach(k=> obj[k]-= Math.ceil(delta/3));
  }
}
const zodiacScores = buildZodiacScore();

/** ==================== ç”Ÿæ€16 â†’ ç”Ÿæ€8 èšåˆï¼ˆå…œåº•ï¼‰ ==================== **/
function eco16to8(eco16){
  const g = [
    [0,1],[2,3],[4,5],[6,7],[8,9],[10,11],[12,13],[14,15]
  ];
  return g.map(([a,b])=> Math.round(((eco16[a]||50)+(eco16[b]||50))/2));
}
const eco8_final = eco16to8(eco16_final);

/** ==================== Chart.js ä¸»é¢˜ ==================== **/
Chart.defaults.color = "#d7defc";
Chart.defaults.borderColor = "rgba(255,255,255,.12)";
Chart.defaults.font.family = `"Inter","Noto Sans SC",system-ui`;
Chart.defaults.plugins.legend.labels.usePointStyle = true;

const G = (ctx, c1, c2)=>{ const g=ctx.createLinearGradient(0,0,0,320); g.addColorStop(0,c1); g.addColorStop(1,c2); return g; };

/** ==================== 1. äº”è¡Œæ¡å½¢å›¾ ==================== **/
{
  const ctx = document.getElementById("barZodiac").getContext("2d");
  new Chart(ctx,{ type:"bar",
    data:{ labels:Object.keys(zodiacScores),
      datasets:[{ label:"äº”è¡Œèƒ½é‡ï¼ˆè±¡å¾ï¼‰", data:Object.values(zodiacScores),
        backgroundColor:G(ctx,"#7c9bff","#3e63ff"), borderRadius:10 }]},
    options:{ responsive:true, maintainAspectRatio:false,
      scales:{ x:{grid:{display:false}}, y:{ beginAtZero:true, max:100, ticks:{ stepSize:25 } } }
  });
}

/** ==================== 2. å››æ¶²è´¨æ¡å½¢ + å¾½ç«  ==================== **/
{
  const ctx = document.getElementById("barTemperament").getContext("2d");
  new Chart(ctx,{ type:"bar",
    data:{ labels:mixTemp.labels,
      datasets:[{ label:"å››æ¶²è´¨ï¼ˆè‡ªè¯„ï¼‰", data:mixTemp.self,
        backgroundColor:G(ctx,"#f6c453","#f59f0b"), borderRadius:10 }]},
    options:{ responsive:true, maintainAspectRatio:false,
      plugins:{ tooltip:{ callbacks:{ afterLabel:(c)=>`ï¼ˆç¯å¢ƒè·¯å¾„ï¼š${mixTemp.env[c.dataIndex] ?? "-"}%ï¼‰` } }},
      scales:{ x:{grid:{display:false}}, y:{ beginAtZero:true, max:100 } }
  });
  // å¾½ç« 
  const box = document.getElementById('tempCompareBadge');
  mixTemp.labels.forEach((k,i)=>{
    const d = Math.round(mixTemp.env[i] - mixTemp.self[i]);
    const span = document.createElement('span');
    span.className = `badge ${d>0?'good':(d<0?'bad':'')}`;
    span.textContent = `${k}  ${d>0?'+':''}${d}%`;
    box.appendChild(span);
  });
}

/** ==================== 3. å¤§äº”æ¡å½¢ + å¾½ç«  ==================== **/
{
  const ctx = document.getElementById("barBig5").getContext("2d");
  const names = ["å¼€æ”¾æ€§","å°½è´£æ€§","å¤–å‘æ€§","å®œäººæ€§","ç¥ç»è´¨"];
  new Chart(ctx,{ type:"bar",
    data:{ labels:names,
      datasets:[
        {label:"è‡ªè¯„", data:mixBig5.self, backgroundColor:G(ctx,"#61dbff","#22b8cf"), borderRadius:10},
        {label:"ç¯å¢ƒ", data:mixBig5.env,  backgroundColor:G(ctx,"#53e08c","#10b981"), borderRadius:10}
      ]},
    options:{ responsive:true, maintainAspectRatio:false,
      scales:{ x:{grid:{display:false}}, y:{ beginAtZero:true, max:100 } }
  });
  const box = document.getElementById('big5DeltaBadge');
  names.forEach((name,i)=>{
    const d = Math.round(mixBig5.env[i] - mixBig5.self[i]);
    let cls = d>0 ? 'good' : (d<0 ? (name==="ç¥ç»è´¨" ? 'good' : 'bad') : '');
    if(name==="ç¥ç»è´¨" && d>0) cls='bad';
    const span = document.createElement('span');
    span.className = `badge ${cls}`;
    span.textContent = `${name}  ${d>0?'+':''}${d}`;
    box.appendChild(span);
  });
}

/** ==================== 4. å¤§äº” & å››æ¶²è´¨é›·è¾¾ ==================== **/
{
  const ctx = document.getElementById("radarBig5").getContext("2d");
  new Chart(ctx,{ type:"radar",
    data:{ labels:["å¼€æ”¾æ€§","å°½è´£æ€§","å¤–å‘æ€§","å®œäººæ€§","ç¥ç»è´¨"],
      datasets:[
        {label:"è‡ªè¯„", data:mixBig5.self, backgroundColor:"rgba(124,155,255,.25)", borderColor:"#7c9bff", pointBackgroundColor:"#7c9bff"},
        {label:"ç¯å¢ƒ", data:mixBig5.env,  backgroundColor:"rgba(82,227,194,.25)",  borderColor:"#52e3c2", pointBackgroundColor:"#52e3c2"}
      ]},
    options:{ responsive:true, maintainAspectRatio:false,
      scales:{ r:{ min:0, max:100, grid:{color:"rgba(255,255,255,.12)"}, angleLines:{color:"rgba(255,255,255,.12)"} } }
  });
}
{
  const ctx = document.getElementById("radarTemperament").getContext("2d");
  new Chart(ctx,{ type:"radar",
    data:{ labels:["å¤šè¡€è´¨","èƒ†æ±è´¨","æŠ‘éƒè´¨","ç²˜æ¶²è´¨"],
      datasets:[
        {label:"è‡ªè¯„", data:mixTemp.self, backgroundColor:"rgba(245,159,11,.25)", borderColor:"#f59f0b", pointBackgroundColor:"#f59f0b"},
        {label:"ç¯å¢ƒ", data:mixTemp.env,  backgroundColor:"rgba(16,185,129,.25)",  borderColor:"#10b981", pointBackgroundColor:"#10b981"}
      ]},
    options:{ responsive:true, maintainAspectRatio:false,
      scales:{ r:{ min:0, max:100, grid:{color:"rgba(255,255,255,.12)"}, angleLines:{color:"rgba(255,255,255,.12)"} } }
  });
}

/** ==================== 5. ç»“æ„/ç”Ÿæ€/æ½œåŠ› ä¸‰ç¯é›·è¾¾ï¼ˆåªè¯»ï¼‰ ==================== **/
{
  const labels8 = ["é•œé¢","ç­‹éª¨","æ°´æµ","ç«ç„°","æŒ‡å—é’ˆ","ç›¾ç‰Œ","æ¡¥æ¢","å²©çŸ³"];
  const ctx = document.getElementById("radarSEP").getContext("2d");
  const radialMax = 100;
  const optBase = { min:0, max:radialMax, grid:{color:"rgba(255,255,255,.12)"}, angleLines:{color:"rgba(255,255,255,.12)"} };
  new Chart(ctx,{ type:"radar",
    data:{ labels:labels8,
      datasets:[
        {label:"ç»“æ„ï¼ˆStructï¼‰",  data:struct8_final, backgroundColor:"rgba(124,155,255,.18)", borderColor:"#7c9bff", pointBackgroundColor:"#7c9bff"},
        {label:"ç”Ÿæ€ï¼ˆEcoÂ·8ï¼‰",   data:eco8_final,    backgroundColor:"rgba(82,227,194,.18)",  borderColor:"#52e3c2", pointBackgroundColor:"#52e3c2"},
        {label:"æ½œåŠ›ï¼ˆPotentialï¼‰", data:potential8,  backgroundColor:"rgba(245,159,11,.18)",  borderColor:"#f59f0b", pointBackgroundColor:"#f59f0b"}
      ]},
    options:{
      responsive:true, maintainAspectRatio:false,
      scales:{ r: optBase },
      plugins:{ legend:{ position:'top' } }
  });

  // æç«¯æ¨¡å¼çš„æ˜¾ç¤ºå¢å¼ºï¼ˆåªå½±å“æ˜¾ç¤ºï¼‰
  if(extremeMode){
    // è½»å¾®Î³æ ¡æ­£ï¼šå¯¹é«˜åˆ†æ®µå¢å¼ºå·®å¼‚
    const gamma = (x)=> Math.round( Math.pow(x/100, 1/1.2) * 100 );
    ["Struct","Eco","Potential"];
    // è¿™é‡ŒåªåŠ ä¸€ä¸ªè§†è§‰æç¤ºï¼Œä¸ä¿®æ”¹æ•°æ®æœ¬èº«
    const tag = document.createElement('div');
    tag.className='badge warn'; tag.style.marginTop='8px';
    tag.textContent='æç«¯æ¨¡å¼ï¼šæ˜¾ç¤ºå·²æ‹‰ä¼¸ï¼ˆä¸å½±å“åº•å±‚åˆ†æ•°ï¼‰';
    document.querySelector('#radarSEP').closest('.card').appendChild(tag);
  }
}

/** ==================== ä¸‹è½½ PNGï¼ˆå¯¼å‡ºå„å›¾ï¼‰ ==================== **/
document.getElementById('btnDownload').addEventListener('click', ()=>{
  const figs = [
    ["zodiac-bar","barZodiac"],
    ["temperament-bar","barTemperament"],
    ["big5-bar","barBig5"],
    ["sep-radar","radarSEP"],
    ["big5-radar","radarBig5"],
    ["temperament-radar","radarTemperament"]
  ];
  figs.forEach(([name,id])=>{
    const el = document.getElementById(id);
    if(!el) return;
    const url = el.toDataURL("image/png");
    const a = document.createElement('a'); a.href=url; a.download=`report-${name}.png`; a.click();
  });
});

/** â€”â€” ä¿è¯å¯¼èˆªå¯ç‚¹ â€”â€” */
(function(){
  try{
    var nav = document.querySelector('.nav');
    if(nav){
      nav.style.pointerEvents = 'auto';
      nav.querySelectorAll('a,button').forEach(function(el){
        el.style.pointerEvents = 'auto';
        el.addEventListener('click', function(e){
          var href = el.getAttribute('href');
          if(href){ window.location.href = href; }
        });
      });
    }
  }catch(e){}
})();
</script>

<a id="dash-fallback" href="dashboard.html" style="position:fixed;right:16px;top:16px;z-index:9999;text-decoration:none" class="btn">Dashboard â†—</a>
</body>
</html>
