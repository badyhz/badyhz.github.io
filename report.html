<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Step 3 Â· äººæ ¼æµ‹è¯„æŠ¥å‘Šï¼ˆç‚«é…·ç‰ˆï¼‰</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3"></script>
<style>
  :root{
    --bg:#0b1020;
    --bg2:#0e1530;
    --card:#0f1a3a;
    --muted:#99a1b3;
    --text:#e8ecff;
    --primary:#7c9bff;
    --accent:#52e3c2;
    --warm:#f59f0b;
    --danger:#ff5c9a;
    --good:#4ade80;
    --ring: rgba(124,155,255,.35);
    --glass: rgba(255,255,255,.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font-family:"Inter","HarmonyOS Sans","Noto Sans SC",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:
      radial-gradient(1200px 800px at -10% -10%, #1b2a6b 0%, transparent 60%),
      radial-gradient(1000px 800px at 110% 0%, #1c3d4f 0%, transparent 55%),
      radial-gradient(1200px 900px at 50% 120%, #251b5a 0%, transparent 60%),
      linear-gradient(180deg, #070b18 0%, #0b1020 100%);
    background-attachment: fixed;
  }
  .container{max-width:1280px;margin:0 auto;padding:18px}
  .heading{
    display:flex;justify-content:space-between;align-items:center;gap:10px;margin:10px 0 18px;
  }
  .title{
    font-size:28px;font-weight:800;letter-spacing:.3px;
    background:linear-gradient(90deg,#a0b8ff 0%,#52e3c2 40%,#f7b500 80%);
    -webkit-background-clip:text;background-clip:text;color:transparent;
    filter: drop-shadow(0 10px 30px rgba(124,155,255,.25));
  }
  .nav{
    display:flex;gap:10px;
   z-index: 10; position: relative; }
  .btn{display:inline-flex;align-items:center;justify-content:center;text-decoration:none;}
  .btn:link,.btn:visited{color:inherit;text-decoration:none}
  .btn{
    padding:12px 16px;border:1px solid rgba(255,255,255,.12);border-radius:12px;
    color:var(--text);background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    cursor:pointer; backdrop-filter: blur(8px); font-size:15px; min-height:42px;
  }
  .btn:hover{box-shadow:0 0 0 4px var(--ring) inset}
  .btn.primary{
    border-color:rgba(124,155,255,.3);
    background:linear-gradient(180deg, rgba(124,155,255,.25), rgba(124,155,255,.06));
  }

  /* card / glass */
  .grid{display:grid;gap:16px}
  .grid.g2{grid-template-columns:1fr 1fr}
  .grid.g3{grid-template-columns:repeat(3,1fr)}
  @media (max-width:1020px){ .grid.g2,.grid.g3{grid-template-columns:1fr} }

  .card{
    position:relative;overflow:hidden;border-radius:18px;padding:16px;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.12);
    box-shadow:
      0 12px 24px rgba(0,0,0,.25),
      0 1px 0 rgba(255,255,255,.06) inset;
  }
  .card::before{
    content:""; position:absolute; inset:-1px;
    background:
      radial-gradient(400px 160px at 10% -10%, rgba(124,155,255,.18), transparent 70%),
      radial-gradient(400px 160px at 110% 10%, rgba(82,227,194,.18), transparent 70%);
    z-index:0; pointer-events:none;
  }
  .card > *{position:relative; z-index:1}

  .card h3{margin:0 0 8px; font-size:16px; font-weight:700; letter-spacing:.2px}
  .sub{color:var(--muted); font-size:12px}

  /* badge / chips */
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .chip{
    padding:6px 10px; border-radius:999px; font-size:12px;
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.12);
  }
  .kv{display:flex;gap:14px;flex-wrap:wrap}
  .kv .k{color:var(--muted);font-size:12px}
  .kv .v{font-weight:700}

  /* compare badge */
  .compare{
    display:flex;gap:10px;flex-wrap:wrap;margin-top:8px
  }
  .badge{
    padding:4px 8px;border-radius:10px;font-size:12px;border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  }
  .badge.good{border-color:rgba(82,227,194,.35); color:#befae7}
  .badge.warn{border-color:rgba(247,181,0,.35); color:#ffe6a1}
  .badge.bad{border-color:rgba(255,92,154,.4); color:#ffc4db}

  /* canvas */
  .chart-wrap{position:relative;height:340px}
  .row-radar{display:grid;grid-template-columns:1fr 1fr; gap:16px}
  @media (max-width:1020px){ .row-radar{grid-template-columns:1fr} }
  .chart-wrap.radar{height:420px}

  /* footer */
  .footer{opacity:.75; text-align:center; font-size:12px; margin:20px 0}

  .chart{ position:relative; height:clamp(300px,56vh,640px) }
</style>
</head>
<body>
  <div class="container">
    <div class="heading">
      <div class="title">ğŸ“Š äººæ ¼æµ‹è¯„æŠ¥å‘Š Â· ç‚«é…·ç‰ˆ</div>
      <div class="nav" style="pointer-events:auto">
        <button class="btn" onclick="location.href='step1.html'">â† ä¸Šä¸€æ­¥</button>
        <button class="btn" onclick="location.href='step2.html'">è¿”å›æ ‡ç­¾</button>
        <a class="btn" href="dashboard.html" role="button" tabindex="0">æŸ¥çœ‹ Dashboard</a>
        <button class="btn primary" id="btnDownload">ä¸‹è½½ PNG</button>
      </div>
    </div>

    <!-- é¡¶éƒ¨æ¦‚è§ˆ -->
    <div class="grid g3">
      <div class="card" id="cardZodiac">
        <h3>ğŸŒŸ æ˜Ÿåº§ä¸äº”è¡Œ</h3>
        <div class="kv">
          <div><span class="k">æ˜Ÿåº§</span> <span class="v" id="zodiacName">â€”</span></div>
          <div><span class="k">å››è±¡</span> <span class="v" id="zodiacElem">â€”</span></div>
          <div><span class="k">äº”è¡Œ</span> <span class="v" id="zodiacFive">â€”</span></div>
        </div>
        <div class="chips" id="zodiacTags"></div>
        <div class="chart-wrap" style="margin-top:10px"><canvas id="barZodiac"></canvas></div>
      </div>

      <div class="card">
        <h3>ğŸª å››æ¶²è´¨å€¾å‘åˆ†å¸ƒï¼ˆStep1 è‡ªè¯„ï¼‰</h3>
        <div class="compare" id="tempCompareBadge"></div>
        <div class="chart-wrap"><canvas id="barTemperament"></canvas></div>
      </div>

      <div class="card">
        <h3>ğŸ“Š åŸºç¡€äººæ ¼ç‰¹è´¨ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰</h3>
        <div class="compare" id="big5DeltaBadge"></div>
        <div class="chart-wrap"><canvas id="barBig5"></canvas></div>
      </div>
    </div>

    <!-- ä¸¤å¼ é›·è¾¾å›¾å¹¶æ’ -->
    <div class="row-radar">
      <div class="card">
        <h3>ğŸ§­ å¤§äº”äººæ ¼å¯¹æ¯”é›·è¾¾ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰</h3>
        <div class="chart-wrap radar"><canvas id="radarBig5"></canvas></div>
      </div>
      <div class="card">
        <h3>âš–ï¸ å››æ¶²è´¨å¯¹æ¯”é›·è¾¾ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰</h3>
        <div class="chart-wrap radar"><canvas id="radarTemperament"></canvas></div>
      </div>
    </div>

    <div class="footer">Â© äººæ ¼æˆé•¿ç«‹ä½“æ¨¡æ‹Ÿå™¨ | è§†è§‰æ¨¡å¼ï¼šNeonÂ·GlassMorph | v1.1</div>
  </div>

<script>
/** ========= æ•°æ®è·å–ï¼šä»¥ step1/step2/step3 ä¸ºä¸»ï¼Œdashboard ä»…ç”¨äºå£å¾„å¯¹é½ï¼ˆä¸æ˜¾ç¤ºï¼‰ ========= **/
// æ˜Ÿåº§ä¿¡æ¯ï¼ˆè‹¥æœ‰ï¼‰
const zodiac = localStorage.getItem('zodiac') || "æœªå¡«å†™";
const zodiacElement = localStorage.getItem('zodiacElement') || "";
const fiveElement = localStorage.getItem('fiveElement') || "";

// Step1ï¼ˆ80é¢˜ï¼‰
const step1_bf = (()=>{ try{ return JSON.parse(localStorage.getItem('step1_bigfive')||'null') }catch(e){return null} })();
const step1_struct = (()=>{ try{ return JSON.parse(localStorage.getItem('step1_struct')||'null') }catch(e){return null} })();
const step1_eco16 = (()=>{ try{ return JSON.parse(localStorage.getItem('step1_eco16')||'null') }catch(e){return null} })();

// Step2ï¼ˆ200æ ‡ç­¾ï¼ŒåŸå§‹åŠ æ€»ï¼‰
const step2_struct_raw = (()=>{ try{ return JSON.parse(localStorage.getItem('step2_struct_raw')||'null') }catch(e){return null} })();
const step2_eco16_raw  = (()=>{ try{ return JSON.parse(localStorage.getItem('step2_eco16_raw')||'null') }catch(e){return null} })();

// Step3ï¼ˆ60çº åé¢˜ï¼Œç»™å‡ºçº åç»“æ„/ç”Ÿæ€ï¼‰
const step3_struct = (()=>{ try{ return JSON.parse(localStorage.getItem('step3_struct')||'null') }catch(e){return null} })();
const step3_eco16  = (()=>{ try{ return JSON.parse(localStorage.getItem('step3_eco16')||'null') }catch(e){return null} })();

/** ========= å…œåº• ========= **/
function arr(n, v=50){ return Array(n).fill(v) }
const S1 = Array.isArray(step1_struct) ? step1_struct : arr(8);
const E1_16 = Array.isArray(step1_eco16) ? step1_eco16 : arr(16);
const S2_raw = Array.isArray(step2_struct_raw) ? step2_struct_raw : arr(8, 0); // åŸå§‹åŠ æ€»
const E2_16_raw = Array.isArray(step2_eco16_raw) ? step2_eco16_raw : arr(16, 0);
const S3 = Array.isArray(step3_struct) ? step3_struct : arr(8, 0);
const E3_16 = Array.isArray(step3_eco16) ? step3_eco16 : arr(16, 0);

// å°† step2 åŸå§‹ â†’ â€œæ ‡ç­¾è·¯å¾„â€æ•°å€¼å£å¾„ï¼ˆ+60åŸºçº¿å clampï¼‰
const S2 = S2_raw.map(v=>Math.max(0, Math.min(100, 60 + Number(v||0))));
const E2_16 = E2_16_raw.map(v=>Math.max(0, Math.min(100, 60 + Number(v||0))));

// ç¯å¢ƒé€šè·¯ï¼ˆæ ‡ç­¾+çº åï¼‰èåˆï¼šé»˜è®¤ 0.6*æ ‡ç­¾ + 0.4*çº å
const alpha = 0.6;
const S_env = S2.map((v,i)=> Math.round((alpha*v + (1-alpha)*(S3[i]||0))));
const E_env16 = E2_16.map((v,i)=> Math.round((alpha*v + (1-alpha)*(E3_16[i]||0))));

// å·¥å…·ï¼šä»ç»“æ„8æ¨å¯¼ç”Ÿæ€16ï¼ˆç”¨äºå…œåº•ï¼‰
function ecology16FromStruct(S){
  const v = i => S[i];
  return [
    (v(7)+v(6))/2,                      // ä¿¡ä»»é€Ÿåº¦ï¼ˆæ¡¥+å²©ï¼‰
    (v(6)+v(3)+v(4))/3,                 // åä½œè´¨é‡ï¼ˆæ¡¥+ç«+é’ˆï¼‰
    (v(5)+v(7))/2,                      // å…³ç³»éŸ§æ€§ï¼ˆç›¾+å²©ï¼‰
    (v(5)+v(6)+v(3))/3,                 // å½±å“åŠå¾„ï¼ˆç›¾+æ¡¥+ç«ï¼‰
    (v(3)+v(4)+v(1))/3,                 // ç›®æ ‡æ¨è¿›åŠ›ï¼ˆç«+é’ˆ+ç­‹ï¼‰
    (v(1)+v(7)+v(4))/3,                 // èŠ‚å¥ç®¡ç†ï¼ˆç­‹+å²©+é’ˆï¼‰
    (v(2)+v(6))/2,                      // åº”å˜æ•ˆç‡ï¼ˆæ°´+æ¡¥ï¼‰
    (v(1)+v(3))/2,                      // è½åœ°é—­ç¯åº¦ï¼ˆç­‹+ç«ï¼‰
    (v(0)+v(2))/2,                      // æ´å¯Ÿæ•é”åº¦ï¼ˆé•œ+æ°´ï¼‰
    (v(2)+v(3))/2,                      // è¡¨è¾¾æ¡ç†åº¦ï¼ˆæ°´+ç«ï¼‰
    (v(0)+v(1)+v(2))/3,                 // ä¿¡æ¯æ•´åˆåº¦ï¼ˆé•œ+ç­‹+æ°´ï¼‰
    (v(2)+v(6))/2,                      // æ”¹è¿›é©±åŠ¨åŠ›ï¼ˆæ°´+æ¡¥ï¼‰
    (v(3)+v(5))/2,                      // èƒ½é‡å¤–æ”¾ï¼ˆç«+ç›¾ï¼‰
    (v(5)+v(1)+v(2))/3,                 // å†²çªé£æ ¼ï¼ˆç›¾+ç­‹+æ°´ï¼‰
    (v(6)+v(7)+v(1))/3,                 // ç¯å¢ƒè´´åˆåº¦ï¼ˆæ¡¥+å²©+ç­‹ï¼‰
    (v(4)+v(1)+v(0))/3                  // å¹¸ç¦æ„ŸåŸºç¡€ï¼ˆé’ˆ+ç­‹+é•œï¼‰
  ];
}
// å…œåº•ï¼šè‹¥è‡ªè¯„/ç¯å¢ƒç”Ÿæ€16ç¼ºå¤±ï¼Œç”¨ç»“æ„æ¨å¯¼
const E1_16_f = (E1_16 || []).some(x=>x!==0) ? E1_16 : ecology16FromStruct(S1);
const E_env16_f = (E_env16 || []).some(x=>x!==0) ? E_env16 : ecology16FromStruct(S_env);

/** ========= ç»“æ„8 â†’ å¤§äº”ï¼ˆçº¿æ€§æ˜ å°„ï¼›ä¸ Step1 çš„å£å¾„ä¸€è‡´æ–¹å‘ï¼‰ ========= **/
// ç»“æ„ 8 é¡ºåºï¼šé•œé¢0 / ç­‹éª¨1 / æ°´æµ2 / ç«ç„°3 / æŒ‡å—é’ˆ4 / ç›¾ç‰Œ5 / æ¡¥æ¢6 / å²©çŸ³7
function big5FromStruct(S){
  const wO = [0.40,0.05,0.15,0.10,0.20,0.00,0.05,0.05]; // å¼€æ”¾æ€§ï¼šé•œ/æ°´/é’ˆ/ç«
  const wC = [0.05,0.45,0.05,0.05,0.20,0.10,0.05,0.05]; // å°½è´£æ€§ï¼šç­‹/é’ˆ/ç›¾/å²©
  const wE = [0.05,0.05,0.10,0.50,0.05,0.00,0.20,0.05]; // å¤–å‘æ€§ï¼šç«/æ¡¥
  const wA = [0.10,0.05,0.40,0.10,0.10,0.05,0.15,0.05]; // å®œäººæ€§ï¼šæ°´/æ¡¥
  const wES= [0.05,0.10,0.05,0.00,0.05,0.45,0.05,0.25]; // æƒ…ç»ªç¨³å®šï¼šç›¾/å²©/ç­‹
  const dot = (a,b)=> a.reduce((s,x,i)=> s + x*(b[i]||0), 0);
  return {
    O: Math.round(dot(wO,S)),
    C: Math.round(dot(wC,S)),
    E: Math.round(dot(wE,S)),
    A: Math.round(dot(wA,S)),
    ES:Math.round(dot(wES,S))
  };
}

// è‡ªè¯„å¤§äº”ï¼ˆç›´æ¥è¯»å–ï¼‰ï¼Œç¯å¢ƒå¤§äº”ï¼ˆç”±æ ‡ç­¾+çº åçš„ç»“æ„8æ˜ å°„å¾—åˆ°ï¼‰
const bf_self = step1_bf || big5FromStruct(S1); // è‹¥æ²¡ä¿å­˜è¿‡ step1_bigfiveï¼Œå°±ç”¨ç»“æ„æ¨å›
const bf_env  = big5FromStruct(S_env);

/** ========= å¤§äº” â†’ å››æ¶²è´¨ï¼ˆè§„èŒƒåŒ–ä¸ºç™¾åˆ†æ¯”ï¼‰ ========= **/
function clamp01(x){ return Math.max(0, Math.min(100, x)); }
function normalizePerc(obj){
  const sum = Object.values(obj).reduce((a,b)=>a+b,0)||1;
  const out = {}; Object.keys(obj).forEach(k=> out[k] = Math.round(obj[k]/sum*100));
  return out;
}
function temperamentFromBig5(bf){
  // ä»¥å¸¸è§å¿ƒç†å­¦æ˜ å°„ä¸ºå‚è€ƒï¼š
  // å¤šè¡€ï¼ˆSanguineï¼‰~ é«˜E/é«˜A/ä¸­O/ä¸­é«˜ES
  // èƒ†æ±ï¼ˆCholericï¼‰~ é«˜E/é«˜C/ä½A/ä½ES
  // æŠ‘éƒï¼ˆMelancholicï¼‰~ é«˜C/ä½ES/ä½E/ä½A
  // ç²˜æ¶²ï¼ˆPhlegmaticï¼‰~ é«˜A/é«˜ES/ä½E/ä¸­O
  const O=bf.O||50, C=bf.C||50, E=bf.E||50, A=bf.A||50, ES=bf.ES||50;
  const Sanguine   = 0.45*E + 0.25*A + 0.15*O + 0.15*ES;
  const Choleric   = 0.45*E + 0.25*C + 0.15*(100-A) + 0.15*(100-ES);
  const Melancholic= 0.40*C + 0.30*(100-ES) + 0.20*(100-E) + 0.10*(100-A);
  const Phlegmatic = 0.40*A + 0.30*ES + 0.20*(100-E) + 0.10*O;
  return normalizePerc({å¤šè¡€è´¨:Sanguine, èƒ†æ±è´¨:Choleric, æŠ‘éƒè´¨:Melancholic, ç²˜æ¶²è´¨:Phlegmatic});
}
const temp_self = temperamentFromBig5(bf_self);
const temp_env  = temperamentFromBig5(bf_env);

/** ========= æ˜Ÿåº§æ ‡ç­¾åº“ ========= **/
const ZODIAC_TAGS = {
  "ç™½ç¾Šåº§":["è¡ŒåŠ¨åŠ›","ç›´ç‡","ç«äº‰","ç«å…ƒç´ "],
  "é‡‘ç‰›åº§":["ç¨³å¥","æ„Ÿå®˜","è€å¿ƒ","åœŸå…ƒç´ "],
  "åŒå­åº§":["å¥½å¥‡","è¡¨è¾¾","å¤šå˜","é£å…ƒç´ "],
  "å·¨èŸ¹åº§":["å…±æƒ…","å®ˆæŠ¤","æ•æ„Ÿ","æ°´å…ƒç´ "],
  "ç‹®å­åº§":["è‡ªä¿¡","èˆå°æ„Ÿ","é¢†å¯¼","ç«å…ƒç´ "],
  "å¤„å¥³åº§":["ç»†è‡´","å®Œç¾","æœåŠ¡","åœŸå…ƒç´ "],
  "å¤©ç§¤åº§":["å¹³è¡¡","å®¡ç¾","ç¤¾äº¤","é£å…ƒç´ "],
  "å¤©èåº§":["æ·±åº¦","æ„å¿—","æ´å¯Ÿ","æ°´å…ƒç´ "],
  "å°„æ‰‹åº§":["æ¢ç´¢","è‡ªç”±","ä¹è§‚","ç«å…ƒç´ "],
  "æ‘©ç¾¯åº§":["è´£ä»»","é•¿æœŸ","ç»“æ„","åœŸå…ƒç´ "],
  "æ°´ç“¶åº§":["åˆ›æ–°","ç‹¬ç«‹","ç†æ€§","é£å…ƒç´ "],
  "åŒé±¼åº§":["æƒ³è±¡","å…±æƒ…","æµªæ¼«","æ°´å…ƒç´ "],
  "æœªå¡«å†™":["â€”"]
};
document.getElementById('zodiacName').textContent = zodiac;
document.getElementById('zodiacElem').textContent = zodiacElement || "â€”";
document.getElementById('zodiacFive').textContent = fiveElement || "â€”";
(ZODIAC_TAGS[zodiac]||["â€”"]).forEach(t=>{
  const s=document.createElement('span'); s.className='chip'; s.textContent=t;
  document.getElementById('zodiacTags').appendChild(s);
});

/** ========= è®¡ç®—äº”è¡Œèƒ½é‡ï¼ˆè±¡å¾æ€§ï¼Œå…œåº•ï¼‰ =========
 * åŸºäº å››è±¡ + äº”è¡Œ ç»™ä¸€ä¸ªå¯è§†åŒ–æ¡å½¢ï¼šç«åœŸé£æ°´å››è±¡æ˜ å°„ä¸ºäº”è¡Œçš„è±¡å¾èƒ½é‡ã€‚
 */
function buildZodiacScore(){
  const base = {ç«:25,åœŸ:25,é£:25,æ°´:25};
  if(zodiacElement){ base[zodiacElement] = (base[zodiacElement]||0) + 10; downOthers(base, zodiacElement, 10); }
  const mapFive = {æœ¨:"é£",ç«:"ç«",åœŸ:"åœŸ",é‡‘:"é£",æ°´:"æ°´"};
  if(fiveElement && mapFive[fiveElement]){
    const t = mapFive[fiveElement];
    base[t] = (base[t]||0) + 8; downOthers(base, t, 8);
  }
  const sum = Object.values(base).reduce((a,b)=>a+b,0);
  const out = {};
  Object.keys(base).forEach(k=> out[k] = Math.round(base[k]/sum*100));
  return out;
  function downOthers(obj, keep, delta){
    const others = Object.keys(obj).filter(k=>k!==keep);
    others.forEach(k=> obj[k]-= Math.ceil(delta/others.length));
  }
}
const zodiacScores = buildZodiacScore();

/** ========= é¢œè‰²å·¥å…· ========= **/
function barGradient(ctx, c1, c2){
  const g = ctx.createLinearGradient(0,0,0,320);
  g.addColorStop(0,c1); g.addColorStop(1,c2);
  return g;
}

/** ========= Chart.js å…¨å±€æ ·å¼ ========= **/
Chart.defaults.color = "#d7defc";
Chart.defaults.borderColor = "rgba(255,255,255,.12)";
Chart.defaults.font.family = `"Inter","Noto Sans SC",system-ui`;
Chart.defaults.plugins.legend.labels.usePointStyle = true;

/** ========= 1. äº”è¡Œæ¡å½¢å›¾ï¼ˆæ˜Ÿåº§ï¼‰ ========= **/
const ctxZ = document.getElementById("barZodiac").getContext("2d");
const gradZ = barGradient(ctxZ, "#7c9bff", "#3e63ff");
new Chart(ctxZ,{
  type:"bar",
  data:{
    labels: Object.keys(zodiacScores),
    datasets:[{
      label:"äº”è¡Œèƒ½é‡ï¼ˆè±¡å¾ï¼‰",
      data: Object.values(zodiacScores),
      backgroundColor: gradZ,
      borderRadius: 10
    }]
  },
  options:{
    responsive:true,
    maintainAspectRatio:false,
    scales:{
      x:{ grid:{display:false}},
      y:{ beginAtZero:true, max:100, ticks:{ stepSize:25 } }
    }
  }
});

/** ========= 2. å››æ¶²è´¨ï¼ˆæ¡å½¢ï¼Œè‡ªè¯„ä¸ºä¸»ï¼›æç¤ºé‡Œæ˜¾ç¤ºç¯å¢ƒè·¯å¾„ï¼‰ ========= **/
const ctxT = document.getElementById("barTemperament").getContext("2d");
const gradT = barGradient(ctxT, "#f6c453", "#f59f0b");
new Chart(ctxT,{
  type:"bar",
  data:{
    labels:Object.keys(temp_self),
    datasets:[{
      label:"å››æ¶²è´¨ï¼ˆè‡ªè¯„â†’ç”±80é¢˜å¤§äº”æ˜ å°„ï¼‰",
      data:Object.values(temp_self),
      backgroundColor: gradT,
      borderRadius: 10
    }]
  },
  options:{
    responsive:true, maintainAspectRatio:false,
    plugins:{ tooltip:{ callbacks:{
      afterLabel:(ctx)=>`ï¼ˆç¯å¢ƒè·¯å¾„ï¼š${temp_env[ctx.label] ?? "-"}%ï¼‰`
    }}},
    scales:{ x:{grid:{display:false}}, y:{beginAtZero:true,max:100}}
  }
});

// å››æ¶²è´¨å˜åŒ–å¾½ç« ï¼šç¯å¢ƒ - è‡ªè¯„
(function renderTempBadges(){
  const box = document.getElementById('tempCompareBadge');
  const keys = Object.keys(temp_self);
  keys.forEach(k=>{
    const a = temp_self[k]||0, b = temp_env[k]||0, d = Math.round(b-a);
    const span = document.createElement('span');
    const cls = d>0 ? 'good' : (d<0 ? 'bad':''); // æå‡â†’goodï¼Œä¸‹é™â†’badï¼ˆä»…ç”¨äºæ˜¾ç¤ºï¼‰
    span.className = `badge ${cls}`;
    span.textContent = `${k}  ${d>0?'+':''}${d}%`;
    box.appendChild(span);
  });
})();

/** ========= 3. å¤§äº”ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰æ¡å½¢ ========= **/
const ctxB = document.getElementById("barBig5").getContext("2d");
const gradB1 = barGradient(ctxB, "#61dbff", "#22b8cf");
const gradB2 = barGradient(ctxB, "#53e08c", "#10b981");
new Chart(ctxB,{
  type:"bar",
  data:{
    labels:["å¼€æ”¾æ€§","å°½è´£æ€§","å¤–å‘æ€§","å®œäººæ€§","æƒ…ç»ªç¨³å®š"],
    datasets:[
      {label:"è‡ªè¯„ï¼ˆ80é¢˜ï¼‰", data:[bf_self.O,bf_self.C,bf_self.E,bf_self.A,bf_self.ES], backgroundColor:gradB1, borderRadius:10},
      {label:"ç¯å¢ƒï¼ˆ200æ ‡ç­¾+80çº åï¼‰", data:[bf_env.O,bf_env.C,bf_env.E,bf_env.A,bf_env.ES],  backgroundColor:gradB2, borderRadius:10}
    ]
  },
  options:{
    responsive:true, maintainAspectRatio:false,
    scales:{ x:{grid:{display:false}}, y:{beginAtZero:true,max:100} }
  }
});

// å¤§äº”å˜åŒ–å¾½ç« ï¼šç¯å¢ƒ - è‡ªè¯„ï¼ˆæƒ…ç»ªç¨³å®šä¸Šå‡æ˜¯å¥½äº‹ï¼‰
(function renderBig5Badges(){
  const box = document.getElementById('big5DeltaBadge');
  const names=["å¼€æ”¾æ€§","å°½è´£æ€§","å¤–å‘æ€§","å®œäººæ€§","æƒ…ç»ªç¨³å®š"];
  const selfVals=[bf_self.O,bf_self.C,bf_self.E,bf_self.A,bf_self.ES];
  const envVals =[bf_env.O,bf_env.C,bf_env.E,bf_env.A,bf_env.ES];
  selfVals.forEach((v,i)=>{
    const d = Math.round((envVals[i]||0) - (v||0));
    const goodUp = (names[i]==="æƒ…ç»ªç¨³å®š") ? (d>0) : (d>0); // ç®€åŒ–ï¼šä¸Šå‡ä¸ºå¥½ï¼›è‹¥ç”¨â€œç¥ç»è´¨â€åˆ™åå‘
    const cls = d===0 ? '' : (goodUp ? 'good' : 'bad');
    const span = document.createElement('span');
    span.className = `badge ${cls}`;
    span.textContent = `${names[i]}  ${d>0?'+':''}${d}`;
    box.appendChild(span);
  });
})();

/** ========= 4a. å¤§äº”é›·è¾¾ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰ ========= **/
const ctxRB = document.getElementById("radarBig5").getContext("2d");
new Chart(ctxRB,{
  type:"radar",
  data:{
    labels:["å¼€æ”¾æ€§","å°½è´£æ€§","å¤–å‘æ€§","å®œäººæ€§","æƒ…ç»ªç¨³å®š"],
    datasets:[
      {
        label:"è‡ªè¯„ï¼ˆ80é¢˜ï¼‰",
        data:[bf_self.O,bf_self.C,bf_self.E,bf_self.A,bf_self.ES],
        backgroundColor:"rgba(124,155,255,.25)",
        borderColor:"#7c9bff",
        pointBackgroundColor:"#7c9bff"
      },
      {
        label:"ç¯å¢ƒï¼ˆ200æ ‡ç­¾+80çº åï¼‰",
        data:[bf_env.O,bf_env.C,bf_env.E,bf_env.A,bf_env.ES],
        backgroundColor:"rgba(82,227,194,.25)",
        borderColor:"#52e3c2",
        pointBackgroundColor:"#52e3c2"
      }
    ]
  },
  options:{
    responsive:true, maintainAspectRatio:false,
    scales:{ r:{ min:0, max:100, grid:{color:"rgba(255,255,255,.12)"}, angleLines:{color:"rgba(255,255,255,.12)"} } }
  }
});

/** ========= 4b. å››æ¶²è´¨é›·è¾¾ï¼ˆè‡ªè¯„ vs ç¯å¢ƒï¼‰ ========= **/
const ctxRT = document.getElementById("radarTemperament").getContext("2d");
new Chart(ctxRT,{
  type:"radar",
  data:{
    labels:Object.keys(temp_self),
    datasets:[
      {
        label:"è‡ªè¯„ï¼ˆç”±80é¢˜å¤§äº”æ˜ å°„ï¼‰",
        data:Object.values(temp_self),
        backgroundColor:"rgba(245,159,11,.25)",
        borderColor:"#f59f0b",
        pointBackgroundColor:"#f59f0b"
      },
      {
        label:"ç¯å¢ƒï¼ˆæ ‡ç­¾+çº åæ˜ å°„ï¼‰",
        data:Object.values(temp_env),
        backgroundColor:"rgba(16,185,129,.25)",
        borderColor:"#10b981",
        pointBackgroundColor:"#10b981"
      }
    ]
  },
  options:{
    responsive:true, maintainAspectRatio:false,
    scales:{ r:{ min:0, max:100, grid:{color:"rgba(255,255,255,.12)"}, angleLines:{color:"rgba(255,255,255,.12)"} } }
  }
});

/** ========= ä¸‹è½½ PNG ========= **/
document.getElementById('btnDownload').addEventListener('click', ()=>{
  const figs = [
    ["zodiac-bar","barZodiac"],
    ["temperament-bar","barTemperament"],
    ["big5-bar","barBig5"],
    ["big5-radar","radarBig5"],
    ["temperament-radar","radarTemperament"]
  ];
  figs.forEach(([name,id])=>{
    const el = document.getElementById(id);
    if(!el) return;
    const url = el.toDataURL("image/png");
    const a = document.createElement('a'); a.href=url; a.download=`report-${name}.png`; a.click();
  });
});
</script>

<script>
// ç¡®ä¿å¯¼èˆªå†…çš„é“¾æ¥ä¸è¢«è¦†ç›–/æ‹¦æˆª
(function(){
  try{
    var nav = document.querySelector('.nav');
    if(nav){
      nav.style.pointerEvents = 'auto';
      nav.querySelectorAll('a,button').forEach(function(el){
        el.style.pointerEvents = 'auto';
        el.addEventListener('click', function(e){
          var href = el.getAttribute('href');
          if(href){ window.location.href = href; }
        });
      });
    }
  }catch(e){}
})();
</script>

<a id="dash-fallback" href="dashboard.html" style="position:fixed;right:16px;top:16px;z-index:9999;text-decoration:none" class="btn">Dashboard â†—</a>
</body>
</html>
