<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>äººæ ¼èŠ±ç“£åŒç¯å›¾ï¼ˆæŸ”å’ŒåŠ¨ç”»ç‰ˆï¼‰</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
           background:#f5f6fa; margin:0; padding:24px; }
    .wrap { max-width: 1800px; margin:auto; background:#fff; border-radius:14px;
            box-shadow: 0 6px 24px rgba(0,0,0,.08); overflow:hidden; }
    header { padding:18px 20px; border-bottom:1px solid #eee; }
    h1 { font-size:18px; margin:0; }
    .hint { padding:10px 16px; font-size:12px; color:#666; border-top:1px dashed #e6e6e6; background:#fafafa; }
    svg { width:100%; height:1200px; display:block; }
    .label { font-size:11px; text-anchor:middle; pointer-events:none; fill:#333; dominant-baseline:middle; }
    .core-label { font-size:13px; font-weight:bold; }
    .petal { cursor:pointer; transition: fill 0.25s, stroke-width 0.25s; }
    .core { pointer-events:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <header><h1>ğŸŒ¸ äººæ ¼èŠ±ç“£åŒç¯å›¾ï¼ˆæ…¢é€ŸæŸ”å’ŒåŠ¨ç”» + é¿è®© + æœå†»å›å¼¹ï¼‰</h1></header>
    <svg id="stage" viewBox="0 0 1800 1200">
      <defs>
        <radialGradient id="bgGradient" cx="50%" cy="50%" r="70%">
          <stop offset="0%" stop-color="#ffd6e8" stop-opacity="0.6"/>
          <stop offset="50%" stop-color="#d6eaff" stop-opacity="0.4"/>
          <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <rect width="100%" height="100%" fill="url(#bgGradient)" opacity="0.35"/>
      <g id="flower"></g>
    </svg>
    <div class="hint">
      âœ… å†…ç¯ä¸»æ ‡ç­¾ï¼›âœ… å¤–ç¯å­æ ‡ç­¾å‡åŒ€åˆ†å¸ƒï¼›âœ… å­æ ‡ç­¾æ…¢é€Ÿæµ®åŠ¨ï¼›âœ… æŸ”å’Œé¿è®©ï¼›âœ… æœå†»å›å¼¹ã€‚
    </div>
  </div>

  <script>
  const W=1800,H=1200,cx=W/2,cy=H/2;
  const coreRingR=300, outerRingR=540;

  const svg=d3.select("#stage");
  const gFlower=svg.select("#flower");
  const gNodes=gFlower.append("g"), gLabels=gFlower.append("g");

  const modules={
    "äººæ ¼ç±»å‹æ ‡ç­¾":["ç±»å‹è¯†åˆ«ç²¾åº¦ï¼ˆ72%ï¼‰","æƒ…ç»ªé©±åŠ¨å€¾å‘ï¼ˆ63%ï¼‰","å†³ç­–é€Ÿåº¦åå¥½ï¼ˆ0.82sï¼‰","æ„ŸçŸ¥æ•é”åº¦ï¼ˆ68%ï¼‰","ç›´è§‰ä¿¡å·å¼ºåº¦ï¼ˆ74%ï¼‰","ç†æ€§-æ„Ÿæ€§å¹³è¡¡ï¼ˆ0.58ï¼‰","é£é™©å®¹å¿æ°´å¹³ï¼ˆ61%ï¼‰","è¡Œä¸ºä¸€è‡´æ€§ï¼ˆ69%ï¼‰"],
    "äººæ ¼ç»“æ„":["å†…å‘/å¤–å‘æ¯”ä¾‹ï¼ˆ46%ï¼‰","æƒ…ç»ªç¨³å®šç»´åº¦ï¼ˆ64%ï¼‰","å†²åŠ¨æ§åˆ¶èƒ½åŠ›ï¼ˆ57%ï¼‰","è‡ªæˆ‘è§‰å¯Ÿæ°´å¹³ï¼ˆ71%ï¼‰","æ„å¿—åŠ›å‚¨å¤‡ï¼ˆ62%ï¼‰","è¡Œä¸ºçµæ´»åº¦ï¼ˆ66%ï¼‰","ä»·å€¼è§‚å†…èšæ€§ï¼ˆ59%ï¼‰","é€‚åº”-æŠ—æ‹’åŒºé—´ï¼ˆ41%ï¼‰"],
    "æ ¸å¿ƒç‰¹è´¨æ ‡ç­¾":["å¼€æ”¾æ€§æŒ‡æ•°ï¼ˆ72%ï¼‰","å°½è´£æ€§æ°´å¹³ï¼ˆ69%ï¼‰","å¤–å‘æ€§å¾—åˆ†ï¼ˆ63%ï¼‰","å®œäººæ€§æŒ‡æ ‡ï¼ˆ77%ï¼‰","ç¥ç»è´¨é£é™©ï¼ˆ55%ï¼‰","é€‚åº”æ€§äººæ ¼ç‰¹å¾ï¼ˆ65%ï¼‰","æƒ…å¢ƒä¾èµ–å‹è¡Œä¸ºæ¨¡å¼ï¼ˆ70%ï¼‰","è‡ªå¾‹ç»´æŒåŠ›ï¼ˆ62%ï¼‰"],
    "ç¯å¢ƒé€‚åº”åŠ›":["å‹åŠ›æ¢å¤é€Ÿåº¦ï¼ˆ68%ï¼‰","å˜åŒ–åº”å¯¹èƒ½åŠ›ï¼ˆ61%ï¼‰","èµ„æºæ•´åˆæ•ˆç‡ï¼ˆ72%ï¼‰","ç¤¾ä¼šé€‚åº”æŒ‡æ•°ï¼ˆ74%ï¼‰","é€»è¾‘é—­ç¯èƒ½åŠ›ï¼ˆ74.5%ï¼‰","ç¯å¢ƒæ‰«æç²¾åº¦ï¼ˆ66%ï¼‰","ä¹ æƒ¯é‡å»ºé€Ÿåº¦ï¼ˆ57%ï¼‰","æŒç»­ä¼˜åŒ–å€¾å‘ï¼ˆ63%ï¼‰"],
    "æ½œåœ¨ç†µå¢è­¦å‘Š":["æƒ…ç»ªå¤±è¡¡é£é™©ï¼ˆ58%ï¼‰","è®¤çŸ¥åå·®é¢‘ç‡ï¼ˆ47%ï¼‰","è¡Œä¸ºåƒµåŒ–ç¨‹åº¦ï¼ˆ62%ï¼‰","å†²çªå‡çº§æ¦‚ç‡ï¼ˆ44%ï¼‰","ç›®æ ‡æ‰§è¡Œé“¾æ¡è„†å¼±ï¼ˆ71%ï¼‰","æ³¨æ„åŠ›åˆ†æ•£æ°´å¹³ï¼ˆ55%ï¼‰","åŠ¨æœºè¡°å‡æ›²çº¿ï¼ˆ52%ï¼‰","è‡ªæˆ‘çŸ›ç›¾é¢‘ç‡ï¼ˆ48%ï¼‰"],
    "ä¼˜åŒ–ç­–ç•¥":["æƒ…ç»ªè°ƒèŠ‚è·¯å¾„ï¼ˆ64%ï¼‰","è®¤çŸ¥é‡æ„æ•ˆèƒ½ï¼ˆ67%ï¼‰","è¡Œä¸ºè®­ç»ƒåé¦ˆç‡ï¼ˆ72%ï¼‰","å…³ç³»ä¿®å¤æŒ‡æ•°ï¼ˆ63%ï¼‰","æƒ…æ„Ÿè¡¨è¾¾ç¼–ç æ•ˆç‡ï¼ˆ59.6%ï¼‰","æ³¨æ„åŠ›ç®¡ç†ç³»ç»Ÿå‡çº§ï¼ˆ44.5%ï¼‰","å­¦ä¹ è¿ç§»æ•ˆç‡ï¼ˆ62%ï¼‰","è‡ªæˆ‘æ¿€åŠ±æœºåˆ¶ï¼ˆ66%ï¼‰"],
    "å‘å±•æ½œåŠ›æ ‡ç­¾":["åˆ›é€ åŠ›æ½œèƒ½ï¼ˆ68%ï¼‰","é¢†å¯¼åŠ›æˆé•¿å€¼ï¼ˆ71%ï¼‰","å…±æƒ…åŠ›æ‹“å±•åº¦ï¼ˆ64%ï¼‰","æŠ—å‹èƒ½åŠ›æå‡æ›²çº¿ï¼ˆ69%ï¼‰","ç»¼åˆå‘å±•æ½œåŠ›ï¼ˆâ˜…â˜…â˜…â˜†â˜†ï¼‰","æ¸è¿›å¼æˆé•¿è·¯å¾„ï¼ˆ60%ï¼‰","çŸ¥è¯†æ•´åˆæ·±åº¦ï¼ˆ63%ï¼‰","å­¦ä¹ é€Ÿåº¦å˜åŒ–ç‡ï¼ˆ57%ï¼‰"],
    "å…³ç³»æ¨¡å¼æ ‡ç­¾":["ä¾èµ–å‹å…³ç³»å¼ºåº¦ï¼ˆ61%ï¼‰","ç‹¬ç«‹å‹å…³ç³»ç»´åº¦ï¼ˆ59%ï¼‰","åˆä½œå‹å…³ç³»æ¨¡å¼ï¼ˆ67%ï¼‰","å¯¹æŠ—å‹å…³ç³»å€¾å‘ï¼ˆ44%ï¼‰","å¹³è¡¡å‹å…³ç³»æ¨¡å¼ï¼ˆ55%ï¼‰","æƒ…å¢ƒé€‚åº”å‹äº’åŠ¨é£æ ¼ï¼ˆ65%ï¼‰","æ²Ÿé€šé€æ˜åº¦ï¼ˆ62%ï¼‰","ä¿¡ä»»æ„å»ºé€Ÿåº¦ï¼ˆ71%ï¼‰"]
  };

  const colors=["#ff7f50","#1e90ff","#9370db","#3cb371","#ff69b4","#ffa500","#20b2aa","#708090"];
  const moduleOrder=Object.keys(modules);
  const angleStep=(2*Math.PI)/moduleOrder.length;

  function measureTextWidth(t,fs=11){
    const temp=svg.append("text").style("font-size",fs+"px").attr("visibility","hidden").text(t);
    const w=temp.node().getBBox().width; temp.remove(); return w;
  }
  function ellipseSizeForText(t,fs=11,px=16,py=10){
    const w=measureTextWidth(t,fs); return {rx:w/2+px, ry:fs*0.85+py};
  }

  const anchors={},nodes=[];
  moduleOrder.forEach((m,i)=>{
    anchors[m]={x:cx+Math.cos(i*angleStep)*coreRingR,y:cy+Math.sin(i*angleStep)*coreRingR,angle:i*angleStep};
  });

  // å†…ç¯ä¸»æ ‡ç­¾
  moduleOrder.forEach((m,mi)=>{
    const a=anchors[m],c=colors[mi%colors.length];
    const baseCore=ellipseSizeForText(m,13,18,12);
    nodes.push({id:`core-${mi}`,kind:"core",key:m,name:m,color:c,x:a.x,y:a.y,
                rx:Math.max(100,baseCore.rx),ry:Math.max(60,baseCore.ry)});
  });

  // å¤–ç¯å­æ ‡ç­¾
  const subs=[];
  moduleOrder.forEach((m,mi)=>{
    const sub=modules[m],c=colors[mi%colors.length];
    sub.forEach((txt,i)=>subs.push({m,mi,c,txt}));
  });

  subs.forEach((s,i)=>{
    const th=(i/subs.length)*2*Math.PI; // å‡åŒ€åˆ†å¸ƒ
    const posX=cx+Math.cos(th)*outerRingR;
    const posY=cy+Math.sin(th)*outerRingR;
    const sz=ellipseSizeForText(s.txt,11,16,10);
    nodes.push({
      id:`tag-${s.mi}-${i}`,kind:"tag",key:s.m,name:s.txt,color:s.c,
      baseTheta:th,x:posX,y:posY,
      rx:sz.rx,ry:sz.ry,rx0:sz.rx,ry0:sz.ry,
      active:false,floatPhase:Math.random()*6.28
    });
  });

  const nodeSel=gNodes.selectAll("ellipse").data(nodes).enter().append("ellipse")
    .attr("class",d=>`petal ${d.kind}`)
    .attr("fill",d=>d.kind==="core"?d.color:"transparent")
    .attr("stroke",d=>d.kind==="core"?"none":d.color)
    .attr("stroke-width",d=>d.kind==="core"?0:2)
    .on("click",function(e,d){
      if(d.kind!=="tag")return;
      d.active=!d.active;
      d.rx=d.active?d.rx0*1.2:d.rx0;
      d.ry=d.active?d.ry0*1.2:d.ry0;
      d3.select(this).attr("fill",d.active?d.color:"transparent").attr("stroke-width",d.active?0:2);
    });

  const labelSel=gLabels.selectAll("text").data(nodes).enter().append("text")
    .attr("class",d=>d.kind==="core"?"label core-label":"label").text(d=>d.name);

  // åŠ¨ç”»å¾ªç¯
  d3.timer(()=>{
    // æ…¢é€Ÿæµ®åŠ¨ + å¹³æ»‘è¿‡æ¸¡
    nodes.forEach(n=>{
      if(n.kind==="tag"){
        n.floatPhase += 0.005; // æ›´æ…¢
        const radialOffset=Math.sin(n.floatPhase)*4;
        const tangentialOffset=Math.cos(n.floatPhase*0.7)*2;
        const r=outerRingR+radialOffset;
        const targetX=cx+Math.cos(n.baseTheta)*r+Math.cos(n.baseTheta+Math.PI/2)*tangentialOffset;
        const targetY=cy+Math.sin(n.baseTheta)*r+Math.sin(n.baseTheta+Math.PI/2)*tangentialOffset;
        n.x += (targetX-n.x)*0.05; // å¹³æ»‘ç§»åŠ¨
        n.y += (targetY-n.y)*0.05;
      }
    });

    // æŸ”å’Œé¿è®©
    for(let i=0;i<nodes.length;i++){
      for(let j=i+1;j<nodes.length;j++){
        const a=nodes[i],b=nodes[j];
        if(a.kind==="core"||b.kind==="core") continue;
        const dx=a.x-b.x,dy=a.y-b.y,dist=Math.sqrt(dx*dx+dy*dy);
        const minDist=Math.max(a.rx,a.ry)+Math.max(b.rx,b.ry)+6;
        if(dist<minDist && dist>0){
          const push=(minDist-dist)*0.1; // æ›´æ¸©å’Œ
          const ux=dx/dist,uy=dy/dist;
          a.x+=ux*push; a.y+=uy*push;
          b.x-=ux*push; b.y-=uy*push;
        }
      }
    }

    // æœå†»å›å¼¹
    nodes.forEach(n=>{
      if(n.kind==="tag" && !n.active){
        n.rx+=(n.rx0-n.rx)*0.05;
        n.ry+=(n.ry0-n.ry)*0.05;
      }
    });

    ticked();
  });

  function ticked(){
    nodeSel.attr("cx",d=>d.x).attr("cy",d=>d.y).attr("rx",d=>d.rx).attr("ry",d=>d.ry);
    labelSel.attr("x",d=>d.x).attr("y",d=>d.y);
  }
  ticked();
  </script>
</body>
</html>
