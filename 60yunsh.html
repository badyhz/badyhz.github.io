<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>å…«å­—åˆç›˜(äº‹ä¸š/å©šå§») Â· åˆ‘/å®³/ç ´ Â· ä¸‰åˆ/ä¸‰ä¼š Â· è½åœ°å»ºè®®</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
<style>
  :root{--bg:#f6f7fb;--card:#fff;--ink:#1f2937;--muted:#6b7280}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:"Noto Sans SC",system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Microsoft YaHei",sans-serif}
  .wrap{padding:22px;max-width:1200px;margin:0 auto}
  h1{margin:0 0 8px 0;font-size:22px}
  .status{font-weight:700;margin:2px 0 14px 0}
  .green{color:#16a34a}.red{color:#ef4444}.orange{color:#f59e0b}
  .card{background:#fff;border-radius:14px;padding:14px;box-shadow:0 8px 28px rgba(2,6,23,.08);margin-top:14px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .row input[type="number"]{width:90px}
  .btn{padding:10px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:700;color:#fff}
  .btn-primary{background:#22c55e}.btn-secondary{background:#3b82f6}.btn-amber{background:#f59e0b}.btn-purple{background:#8b5cf6}
  .muted{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(4,minmax(160px,1fr));gap:8px}
  .kpi{background:#0b1020;color:#fff;border-radius:12px;padding:12px}
  .kpi h3{margin:0 0 6px 0;font-size:13px;opacity:.8;font-weight:500}
  .kpi div{font-size:18px;font-weight:800}
  .code{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0b1020;color:#cbd5e1;padding:10px;border-radius:10px;white-space:pre-wrap}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{border-bottom:1px solid #e5e7eb;padding:10px 8px;text-align:left}
  th{background:#f9fafb}
  .scroll{max-height:60vh;overflow:auto;border-radius:12px}
  .tips{font-size:13px;line-height:1.5;color:#374151}
</style>
</head>
<body>
<div class="wrap">
  <h1>å…«å­—åˆç›˜ Â· ç”¨äººè¯†äººï¼ˆäº‹ä¸šè´¢è¿ / å©šå§»ï¼‰</h1>
  <div id="engineStatus" class="status">æ’ç›˜å¼•æ“ï¼šlunar-javascriptï¼ˆåŠ è½½ä¸­â€¦ï¼‰</div>

  <!-- è¾“å…¥ -->
  <div class="card">
    <h2 style="margin:0 0 8px 0">ç”²æ–¹ï¼ˆAï¼‰å‡ºç”Ÿä¿¡æ¯</h2>
    <div class="row">
      <input type="number" id="Ayear" placeholder="å¹´">
      <input type="number" id="Amonth" placeholder="æœˆ">
      <input type="number" id="Aday" placeholder="æ—¥">
      <input type="number" id="Ahour" placeholder="æ—¶">
      <button class="btn btn-primary" id="btnA">ç”ŸæˆAå››æŸ±</button>
    </div>
    <h2 style="margin:12px 0 8px 0">ä¹™æ–¹ï¼ˆBï¼‰å‡ºç”Ÿä¿¡æ¯</h2>
    <div class="row">
      <input type="number" id="Byear" placeholder="å¹´">
      <input type="number" id="Bmonth" placeholder="æœˆ">
      <input type="number" id="Bday" placeholder="æ—¥">
      <input type="number" id="Bhour" placeholder="æ—¶">
      <button class="btn btn-primary" id="btnB">ç”ŸæˆBå››æŸ±</button>
    </div>
    <div class="row" style="margin-top:8px">
      <button class="btn btn-secondary" id="btnCareer">åˆç›˜ï¼šäº‹ä¸šè´¢è¿ï¼ˆè¿è¡Œï¼‰</button>
      <button class="btn btn-purple" id="btnMarriage">åˆç›˜ï¼šå©šå§»ï¼ˆè¿è¡Œï¼‰</button>
      <button class="btn btn-amber" id="btnTest">è¿è¡Œç¤ºä¾‹</button>
    </div>
    <div class="muted" style="margin-top:6px">æç¤ºï¼šå°æ—¶æœªçŸ¥å¯å¡« 12ã€‚è‹¥è¦èµ·è¿å²æ•°/çœŸå¤ªé˜³æ—¶ï¼Œè¯·è¡¥æ€§åˆ«ä¸å‡ºç”Ÿåœ°ï¼ˆæœ¬ç‰ˆæœ¬ä¸å«ï¼‰ã€‚</div>
  </div>

  <!-- A / B æ’ç›˜ -->
  <div class="card" id="panelA" style="display:none">
    <h2>ğŸ“œ ç”²æ–¹ A â€” å››æŸ±ï¼ˆå«åœ°æ”¯è—å¹²/å–œç”¨ç¥ï¼‰</h2>
    <div class="grid" id="kpiA"></div>
    <div class="scroll" style="margin-top:8px">
      <table id="tabA"><thead><tr><th>æŸ±</th><th>å¤©å¹²</th><th>åœ°æ”¯</th><th>è—å¹²æ‹†è§£</th></tr></thead><tbody></tbody></table>
    </div>
    <pre class="code" id="txtA"></pre>
  </div>

  <div class="card" id="panelB" style="display:none">
    <h2>ğŸ“œ ä¹™æ–¹ B â€” å››æŸ±ï¼ˆå«åœ°æ”¯è—å¹²/å–œç”¨ç¥ï¼‰</h2>
    <div class="grid" id="kpiB"></div>
    <div class="scroll" style="margin-top:8px">
      <table id="tabB"><thead><tr><th>æŸ±</th><th>å¤©å¹²</th><th>åœ°æ”¯</th><th>è—å¹²æ‹†è§£</th></tr></thead><tbody></tbody></table>
    </div>
    <pre class="code" id="txtB"></pre>
  </div>

  <!-- åˆç›˜ -->
  <div class="card" id="panelCompat" style="display:none">
    <h2>ğŸ¤ åˆç›˜ç»“æœ <span id="compatType"></span></h2>
    <div class="grid" id="kpiC"></div>

    <div class="card" style="background:#f9fafb;margin-top:12px">
      <h3 style="margin:4px 0 8px 0;">å…³ç³»ç»“æ„ä¸ç›¸äº’ä½œç”¨ï¼ˆè§£é‡Šå±‚ï¼‰</h3>
      <pre class="code" id="txtCompat"></pre>
    </div>

    <div class="card" style="background:#fff;margin-top:12px">
      <h3 style="margin:4px 0 8px 8px;">åˆ‘ / å®³ / ç ´ Â· ä¸‰åˆ / ä¸‰ä¼š Â· ä¸‰åˆå±€ï¼ˆç°è±¡ & å½±å“ï¼‰</h3>
      <div class="scroll">
        <table id="tabXingHaiPo"><thead>
          <tr><th>å¯¹è±¡</th><th>åˆ‘</th><th>å®³</th><th>ç ´</th><th>ä¸‰åˆå€¾å‘</th><th>ä¸‰ä¼šå€¾å‘</th><th>è¯´æ˜</th></tr>
        </thead><tbody></tbody></table>
      </div>
      <pre class="code" id="txtXhpExplain"></pre>
    </div>

    <div class="card" style="background:#fff;margin-top:12px">
      <h3 style="margin:4px 0 8px 0;">ç ´è§£ä¸è½åœ°å»ºè®®ï¼ˆå…ƒç´  / æœˆä»½ / è¡Œä¸šï¼‰</h3>
      <ol id="adviceList" style="margin:0 0 0 18px"></ol>
      <div class="tips">
        <p><b>äº”è¡Œâ†’å†œå†æœˆä»½â†’é˜³å†å¤§è‡´åŒºé—´â†’è¡Œä¸šç¤ºä¾‹</b></p>
        <ul>
          <li><b>æœ¨ï¼š</b>å¯…æœˆ(æ­£æœˆ, çº¦1/ä¸‹-2/ä¸­)ãƒ»å¯æœˆ(äºŒæœˆ, çº¦2/ä¸‹-3/ä¸‹) â†’ æ•™è‚²/æ–‡åŒ–/å‡ºç‰ˆ/å›­æ—/åŒ»è¯ç ”å‘/ç”Ÿç‰©</li>
          <li><b>ç«ï¼š</b>å·³æœˆ(å››æœˆ, çº¦5/ä¸Š-6/ä¸Š)ãƒ»åˆæœˆ(äº”æœˆ, çº¦6/ä¸Š-7/ä¸Š) â†’ åª’ä½“/å†…å®¹/å“ç‰Œ/äº’è”ç½‘/ç”µå•†/é¤é¥®</li>
          <li><b>åœŸï¼š</b>è¾°/æœª/æˆŒ/ä¸‘ï¼ˆæœˆï¼‰ â†’ åœ°äº§/å†œä¸š/å»ºæ/ä¾›åº”é“¾/äººäº‹/è´¢åŠ¡</li>
          <li><b>é‡‘ï¼š</b>ç”³æœˆ(ä¸ƒæœˆ, çº¦8/ä¸Š-9/ä¸Š)ãƒ»é…‰æœˆ(å…«æœˆ, çº¦9/ä¸Š-10/ä¸Š) â†’ é‡‘è/æ³•å¾‹/å’¨è¯¢/é‡‘å±/å®‰é˜²/åˆ¶é€ </li>
          <li><b>æ°´ï¼š</b>äº¥æœˆ(åæœˆ, çº¦11/ä¸Š-12/ä¸Š)ãƒ»å­æœˆ(åä¸€æœˆ, çº¦12/ä¸Š-1/ä¸Š) â†’ ç§‘æŠ€/æ•°æ®/ç‰©æµ/èˆªè¿/æ•™è‚²(ç†ç§‘)/å‡ºæµ·</li>
        </ul>
        <p class="muted">â€» é˜³å†åŒºé—´ä¸º<b>å¤§è‡´å‚è€ƒ</b>ï¼Œæ‹©æ—¥ä»¥åœ°æ”¯æœˆä»½ä¸ºå‡†ã€‚</p>
      </div>
    </div>
  </div>
</div>

<script>
  // å¼•æ“çŠ¶æ€æç¤º
  window.addEventListener('load', () => {
    const st = document.getElementById('engineStatus');
    if (window.Solar && window.Lunar) { st.textContent='æ’ç›˜å¼•æ“ï¼šlunar-javascriptï¼ˆå·²å°±ç»ªï¼‰'; st.classList.add('green'); }
    else { st.textContent='æ’ç›˜å¼•æ“ï¼šlunar-javascriptï¼ˆåŠ è½½å¤±è´¥ï¼‰'; st.classList.add('red'); }
  });

  // â€”â€” åŸºç¡€å­—å…¸ â€”â€” //
  const wuxingGan = {ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'};
  const wuxingZhi = {å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'};
  const zhiCang = {
    å­:[['ç™¸',1.0]], ä¸‘:[['å·±',0.6],['ç™¸',0.2],['è¾›',0.2]],
    å¯…:[['ç”²',0.6],['ä¸™',0.3],['æˆŠ',0.1]], å¯:[['ä¹™',1.0]],
    è¾°:[['æˆŠ',0.6],['ä¹™',0.2],['ç™¸',0.2]], å·³:[['ä¸™',0.6],['æˆŠ',0.2],['åºš',0.2]],
    åˆ:[['ä¸',0.7],['å·±',0.3]], æœª:[['å·±',0.6],['ä¸',0.2],['ä¹™',0.2]],
    ç”³:[['åºš',0.6],['å£¬',0.3],['æˆŠ',0.1]], é…‰:[['è¾›',1.0]],
    æˆŒ:[['æˆŠ',0.6],['è¾›',0.2],['ä¸',0.2]], äº¥:[['å£¬',0.7],['ç”²',0.3]],
  };
  const SHENG = {æœ¨:'ç«', ç«:'åœŸ', åœŸ:'é‡‘', é‡‘:'æ°´', æ°´:'æœ¨'};
  const KE    = {æœ¨:'åœŸ', ç«:'é‡‘', åœŸ:'æ°´', é‡‘:'æœ¨', æ°´:'ç«'};
  const ganHe = {ç”²:'å·±',ä¹™:'åºš',ä¸™:'è¾›',ä¸:'å£¬',æˆŠ:'ç™¸',å·±:'ç”²',åºš:'ä¹™',è¾›:'ä¸™',å£¬:'ä¸',ç™¸:'æˆŠ'};
  const ganChong = {ç”²:'åºš',ä¹™:'è¾›',ä¸™:'å£¬',ä¸:'ç™¸',æˆŠ:'ç”²',å·±:'ä¹™',åºš:'ç”²',è¾›:'ä¹™',å£¬:'ä¸™',ç™¸:'ä¸'};
  const zhiChongPairs = new Set(['å­åˆ','åˆå­','ä¸‘æœª','æœªä¸‘','å¯…ç”³','ç”³å¯…','å¯é…‰','é…‰å¯','è¾°æˆŒ','æˆŒè¾°','å·³äº¥','äº¥å·³']);
  const zhiHePairs = new Set(['å­ä¸‘','ä¸‘å­','å¯…äº¥','äº¥å¯…','å¯æˆŒ','æˆŒå¯','è¾°é…‰','é…‰è¾°','å·³ç”³','ç”³å·³','åˆæœª','æœªåˆ']);

  // åˆ‘/å®³/ç ´ & ä¸‰åˆ/ä¸‰ä¼š
  const xingPairs = new Set(['å¯…å·³','å·³ç”³','ç”³å¯…','ä¸‘æœª','æœªæˆŒ','æˆŒä¸‘','å­å¯','å¯å­']); // è‡ªåˆ‘å¦è®°
  const selfXing = new Set(['è¾°','åˆ','é…‰','äº¥']);
  const haiPairs = new Set(['å­æœª','æœªå­','ä¸‘åˆ','åˆä¸‘','å¯…å·³','å·³å¯…','å¯è¾°','è¾°å¯','ç”³äº¥','äº¥ç”³','é…‰æˆŒ','æˆŒé…‰']);
  const poPairs  = new Set(['å­é…‰','é…‰å­','ä¸‘è¾°','è¾°ä¸‘','å¯…äº¥','äº¥å¯…','å¯åˆ','åˆå¯','ç”³å·³','å·³ç”³','æœªæˆŒ','æˆŒæœª']);
  const sanHeGroups = [
    {name:'æ°´å±€', set:new Set(['ç”³','å­','è¾°']), elem:'æ°´'},
    {name:'æœ¨å±€', set:new Set(['äº¥','å¯','æœª']), elem:'æœ¨'},
    {name:'ç«å±€', set:new Set(['å¯…','åˆ','æˆŒ']), elem:'ç«'},
    {name:'é‡‘å±€', set:new Set(['å·³','é…‰','ä¸‘']), elem:'é‡‘'},
  ];
  const sanHuiGroups = [
    {name:'æ°´ä¼š', set:new Set(['äº¥','å­','ä¸‘']), elem:'æ°´'},
    {name:'æœ¨ä¼š', set:new Set(['å¯…','å¯','è¾°']), elem:'æœ¨'},
    {name:'ç«ä¼š', set:new Set(['å·³','åˆ','æœª']), elem:'ç«'},
    {name:'é‡‘ä¼š', set:new Set(['ç”³','é…‰','æˆŒ']), elem:'é‡‘'},
  ];

  // å…ƒç´ â†’æœˆä»½(åœ°æ”¯)â†’é˜³å†åŒºé—´â†’è¡Œä¸š
  const elementMonths = {
    æœ¨: { zhi:['å¯…','å¯'], greg:['çº¦1æœˆä¸‹æ—¬-3æœˆä¸‹æ—¬'], jobs:['æ•™è‚²','æ–‡åŒ–','å‡ºç‰ˆ','å›­æ—','åŒ»è¯ç ”å‘','ç”Ÿç‰©'] },
    ç«: { zhi:['å·³','åˆ'], greg:['çº¦5æœˆä¸Šæ—¬-7æœˆä¸Šæ—¬'], jobs:['åª’ä½“','å†…å®¹','å“ç‰Œ','äº’è”ç½‘','ç”µå•†','é¤é¥®'] },
    åœŸ: { zhi:['è¾°','æœª','æˆŒ','ä¸‘'], greg:['çº¦3æœˆæœ«-1æœˆï¼ˆå«æ¢å­£å››åœŸæœˆï¼‰'], jobs:['åœ°äº§','å†œä¸š','å»ºæ','ä¾›åº”é“¾','äººäº‹','è´¢åŠ¡'] },
    é‡‘: { zhi:['ç”³','é…‰'], greg:['çº¦8æœˆä¸Šæ—¬-10æœˆä¸Šæ—¬'], jobs:['é‡‘è','æ³•å¾‹','å’¨è¯¢','é‡‘å±','å®‰é˜²','åˆ¶é€ '] },
    æ°´: { zhi:['äº¥','å­'], greg:['çº¦11æœˆä¸Šæ—¬-1æœˆä¸Šæ—¬'], jobs:['ç§‘æŠ€','æ•°æ®','ç‰©æµ','èˆªè¿','æ•™è‚²(ç†ç§‘)','å‡ºæµ·'] }
  };

  // â€”â€” å·¥å…·å‡½æ•° â€”â€” //
  function needInputs(prefix){
    const y=parseInt(document.getElementById(prefix+'year').value,10);
    const m=parseInt(document.getElementById(prefix+'month').value,10);
    const d=parseInt(document.getElementById(prefix+'day').value,10);
    const h=parseInt(document.getElementById(prefix+'hour').value,10);
    if(!y||!m||!d||Number.isNaN(h)){ alert('è¯·è¾“å…¥å®Œæ•´çš„ '+(prefix==='A'?'ç”²æ–¹':'ä¹™æ–¹')+' å¹´/æœˆ/æ—¥/æ—¶'); return null; }
    if(!window.Solar||!window.Lunar){ alert('å¼•æ“æœªåŠ è½½æˆåŠŸ'); return null; }
    return {y,m,d,h};
  }
  const zhiCangText = z => (zhiCang[z]||[]).map(([g,w])=>`${g}(${w})`).join(' + ');

  function tenGod(dayGan, otherGan){
    const YY={ç”²:1,ä¸™:1,æˆŠ:1,åºš:1,å£¬:1,ä¹™:0,ä¸:0,å·±:0,è¾›:0,ç™¸:0};
    const dm=wuxingGan[dayGan], om=wuxingGan[otherGan]; if(!dm||!om) return 'â€”';
    const sameYY = YY[dayGan]===YY[otherGan];
    if(om===dm) return sameYY?'æ¯”è‚©':'åŠ«è´¢';
    if(SHENG[dm]===om) return sameYY?'é£Ÿç¥':'ä¼¤å®˜';
    if(SHENG[om]===dm) return sameYY?'æ­£å°':'åå°';
    if(KE[dm]===om)    return sameYY?'æ­£è´¢':'åè´¢';
    if(KE[om]===dm)    return sameYY?'æ­£å®˜':'ä¸ƒæ€';
    return 'â€”';
  }
  function tallyFiveElements(stems, branches, monthZhi){
    const count={æœ¨:0,ç«:0,åœŸ:0,é‡‘:0,æ°´:0};
    stems.forEach(g=>{const w=wuxingGan[g]; if(w) count[w]+=1;});
    branches.forEach(z=>{(zhiCang[z]||[]).forEach(([g,w])=>{const ww=wuxingGan[g]; if(ww) count[ww]+=w;});});
    const mw=wuxingZhi[monthZhi]; if(mw) count[mw]+=0.5; // æœˆä»¤åŠ æƒ
    return count;
  }
  function rootingStrength(dayGan, branches){
    let s=0; branches.forEach(z=>{(zhiCang[z]||[]).forEach(([g,w])=>{if(g===dayGan) s+=w;});});
    return s;
  }
  function strongWeakAndYong(ec){
    const stems=[ec.getYearGan(),ec.getMonthGan(),ec.getDayGan(),ec.getTimeGan()];
    const zhis=[ec.getYearZhi(),ec.getMonthZhi(),ec.getDayZhi(),ec.getTimeZhi()];
    const wc=tallyFiveElements(stems,zhis,ec.getMonthZhi());
    const dayGan=ec.getDayGan(), dayMaster=wuxingGan[dayGan], root=rootingStrength(dayGan,zhis);
    let strongWeak='ä¸­å’Œ'; const own=wc[dayMaster];
    if(own+root>=3.5) strongWeak='åå¼º';
    if(own+root<=2.0) strongWeak='åå¼±';
    const beiKe={}, shengWo={}; Object.entries(KE).forEach(([a,b])=>beiKe[b]=a); Object.entries(SHENG).forEach(([a,b])=>shengWo[b]=a);
    const yongSet=new Set(), jiSet=new Set();
    if(strongWeak==='åå¼º'){ yongSet.add(KE[dayMaster]); yongSet.add(beiKe[dayMaster]); jiSet.add(dayMaster); }
    else if(strongWeak==='åå¼±'){ yongSet.add(dayMaster); yongSet.add(shengWo[dayMaster]); jiSet.add(KE[dayMaster]); jiSet.add(SHENG[dayMaster]); }
    else { const order=Object.entries(wc).sort((a,b)=>a[1]-b[1]); yongSet.add(order[0][0]); yongSet.add(order[1][0]); jiSet.add(order[4][0]); }
    return {dayGan, dayMaster, strongWeak, wc, yongSet, jiSet, root};
  }
  function patternGuess(ec){
    const d=ec.getDayGan(), dW=wuxingGan[d];
    const tg = {å¹´: tenGod(d, ec.getYearGan()), æœˆ: tenGod(d, ec.getMonthGan()), æ—¶: tenGod(d, ec.getTimeGan())};
    const c={}; ['æ¯”è‚©','åŠ«è´¢','é£Ÿç¥','ä¼¤å®˜','æ­£è´¢','åè´¢','æ­£å®˜','ä¸ƒæ€','æ­£å°','åå°'].forEach(k=>c[k]=0);
    Object.values(tg).forEach(v=>{ if(c[v]!=null) c[v]++; });
    const yW = wuxingZhi[ec.getMonthZhi()];
    const has=k=>(c[k]||0)>0, many=(...ks)=>ks.reduce((s,k)=>s+(c[k]||0),0);
    if (has('æ­£å®˜') && !has('ä¸ƒæ€')) return {name:'æ­£å®˜æ ¼', reason:'å®˜æ¸…ä¸è§æ€'};
    if (has('ä¸ƒæ€') && (has('æ­£å°')||has('åå°'))) return {name:'æ€å°ç›¸ç”Ÿ', reason:'æœ‰æ€æœ‰å°ï¼ŒåŒ–æ€ä¸ºæƒ'};
    if (has('ä¼¤å®˜') && (has('æ­£å°')||has('åå°'))) return {name:'ä¼¤å®˜é…å°', reason:'ä¼¤å®˜æœ‰å°åˆ¶'};
    if ((has('é£Ÿç¥')||has('ä¼¤å®˜')) && (has('æ­£è´¢')||has('åè´¢'))) return {name:'é£Ÿä¼¤ç”Ÿè´¢', reason:'æ³„ç§€ç”Ÿè´¢'};
    if (many('æ¯”è‚©','åŠ«è´¢')>=2) return {name:'æ¯”åŠ«æ—º', reason:'åŒå…šæ—º'};
    if (yW===dW) return {name:'èº«æ—ºå–æ³„', reason:'æœˆä»¤åŒæ°”'};
    return {name:'å¹³æ ¼', reason:'æœªè§¦å‘å…¸å‹é—¨ç±»'};
  }

  // ç”Ÿæˆå››æŸ±
  function genChart(prefix){
    const inps=needInputs(prefix); if(!inps) return null;
    const {y,m,d,h}=inps, s=Solar.fromYmdHms(y,m,d,h,0,0), l=s.getLunar(), ec=l.getEightChar();
    const stems=[ec.getYearGan(),ec.getMonthGan(),ec.getDayGan(),ec.getTimeGan()];
    const zhis=[ec.getYearZhi(),ec.getMonthZhi(),ec.getDayZhi(),ec.getTimeZhi()];
    const sw=strongWeakAndYong(ec), pat=patternGuess(ec);

    const kpiEl=document.getElementById('kpi'+prefix);
    const panel=document.getElementById('panel'+prefix);
    if(panel) panel.style.display='block';
    kpiEl.innerHTML='';
    [['å››æŸ±',ec.toString()],['æ—¥ä¸»', ec.getDayGan()+'ï¼ˆ'+sw.dayMaster+'ï¼‰'],['å¼ºå¼±', `${sw.strongWeak}ï¼ˆé€šæ ¹${sw.root.toFixed(2)}ï¼‰`],['å–œç”¨', [...sw.yongSet].join('ã€')||'â€”'],['å¿Œç¥',[...sw.jiSet].join('ã€')||'â€”'],['å‘½æ ¼', pat.name+'ï¼š'+pat.reason]].forEach(([k,v])=>{
      const el=document.createElement('div'); el.className='kpi'; el.innerHTML=`<h3>${k}</h3><div>${v}</div>`; kpiEl.appendChild(el);
    });

    const tb=document.querySelector('#tab'+prefix+' tbody'); tb.innerHTML='';
    [['å¹´',0],['æœˆ',1],['æ—¥',2],['æ—¶',3]].forEach(([lab,i])=>{
      const tr=document.createElement('tr'); tr.innerHTML=`
        <td>${lab}</td>
        <td>${stems[i]}ï¼ˆ${wuxingGan[stems[i]]}ï¼‰</td>
        <td>${zhis[i]}ï¼ˆ${wuxingZhi[zhis[i]]}ï¼‰</td>
        <td>${zhiCangText(zhis[i])}</td>`;
      tb.appendChild(tr);
    });

    const lines=[];
    lines.push(`å…¬å†ï¼š${y}-${m}-${d} ${String(h).padStart(2,'0')}:00`);
    lines.push(`å››æŸ±ï¼š${ec.toString()}`);
    const wc=sw.wc;
    lines.push(`äº”è¡Œç»Ÿè®¡ï¼ˆå¹²1.0 + è—å¹²æƒé‡ + æœˆä»¤0.5ï¼‰ï¼šæœ¨${wc.æœ¨.toFixed(1)} ç«${wc.ç«.toFixed(1)} åœŸ${wc.åœŸ.toFixed(1)} é‡‘${wc.é‡‘.toFixed(1)} æ°´${wc.æ°´.toFixed(1)}`);
    document.getElementById('txt'+prefix).textContent=lines.join('\n');

    return { y,m,d,h, lunar:l, ec, stems, zhis,
      dayGan: ec.getDayGan(), dayZhi: ec.getDayZhi(),
      dayElement: wuxingGan[ec.getDayGan()],
      sw, pat
    };
  }

  // å…³ç³»ç»Ÿè®¡
  function countInteractions(A,B){
    const res={ganHe:0,ganChong:0,zhiHe:0,zhiChong:0,notes:[]};
    const lab=['å¹´','æœˆ','æ—¥','æ—¶'];
    for(let i=0;i<4;i++){
      const gA=A.stems[i], gB=B.stems[i], zA=A.zhis[i], zB=B.zhis[i];
      if(ganHe[gA]===gB){ res.ganHe+=(i===2?2:1); res.notes.push(`å¤©å¹²${lab[i]}æŸ±åˆï¼š${gA}+${gB}`); }
      if(ganChong[gA]===gB){ res.ganChong+=(i===2?2:1); res.notes.push(`å¤©å¹²${lab[i]}æŸ±å†²ï¼š${gA}Ã—${gB}`); }
      if(zhiHePairs.has(zA+zB)){ res.zhiHe+=(i===2?2:1); res.notes.push(`åœ°æ”¯${lab[i]}æŸ±åˆï¼š${zA}+${zB}`); }
      if(zhiChongPairs.has(zA+zB)){ res.zhiChong+=(i===2?2:1); res.notes.push(`åœ°æ”¯${lab[i]}æŸ±å†²ï¼š${zA}Ã—${zB}`); }
    }
    return res;
  }
  function favorTally(A,B){
    let aGain=0,bGain=0,aHitJi=0,bHitJi=0,notes=[];
    const countByWux = chart => chart.stems.map(g=>wuxingGan[g]).reduce((m,w)=>(m[w]=(m[w]||0)+1,m),{});
    const Aw=countByWux(A), Bw=countByWux(B);
    A.sw.yongSet.forEach(w=>{ if((Bw[w]||0)>0){ aGain+=1; notes.push(`Aå–œç”¨${w} â† Bå¤©å¹²æä¾›`); }});
    B.sw.yongSet.forEach(w=>{ if((Aw[w]||0)>0){ bGain+=1; notes.push(`Bå–œç”¨${w} â† Aå¤©å¹²æä¾›`); }});
    A.sw.jiSet.forEach(w=>{ if((Bw[w]||0)>0){ aHitJi+=1; notes.push(`Aå¿Œç¥${w} â† Bå¤©å¹²æ”¾å¤§`); }});
    B.sw.jiSet.forEach(w=>{ if((Aw[w]||0)>0){ bHitJi+=1; notes.push(`Bå¿Œç¥${w} â† Aå¤©å¹²æ”¾å¤§`); }});
    return {aGain,bGain,aHitJi,bHitJi,notes};
  }

  // åˆ‘å®³ç ´+ä¸‰åˆä¸‰ä¼š
  function analyzeXHP_San(zhiList){
    let xing=0, hai=0, po=0, self=0, info=[];
    for(let i=0;i<zhiList.length;i++){
      for(let j=i;j<zhiList.length;j++){
        const a=zhiList[i], b=zhiList[j];
        if(i===j && selfXing.has(a)){ self++; info.push(`è‡ªåˆ‘ï¼š${a}`); }
        if(i===j) continue;
        const ab=a+b, ba=b+a;
        if(xingPairs.has(ab)||xingPairs.has(ba)){ xing++; info.push(`åˆ‘ï¼š${a}â†”${b}`); }
        if(haiPairs.has(ab)||haiPairs.has(ba)){ hai++; info.push(`å®³ï¼š${a}â†”${b}`); }
        if(poPairs.has(ab)||poPairs.has(ba)){ po++; info.push(`ç ´ï¼š${a}â†”${b}`); }
      }
    }
    function detectTri(groups){
      const hits=[];
      groups.forEach(g=>{
        const cnt = [...g.set].filter(z=>zhiList.includes(z)).length;
        if(cnt>=2) hits.push(`${g.name}ï¼ˆ${g.elem}ï¼Œ${cnt}/3ï¼‰`);
      });
      return hits.join('ã€') || 'â€”';
    }
    return {
      xing: xing + (self>0?1:0),
      hai, po,
      sanhe: detectTri(sanHeGroups),
      sanhui: detectTri(sanHuiGroups),
      explain: info.join('ï¼›') || 'â€”'
    };
  }

  // è¯„åˆ†
  function scoreMarriage(A,B){
    let score=60, reasons=[];
    const dA=A.dayGan, dB=B.dayGan, zA=A.dayZhi, zB=B.dayZhi;
    if(ganHe[dA]===dB){ score+=15; reasons.push(`æ—¥å¹²äº”åˆï¼š${dA}+${dB} â†’ +15`); }
    if(ganChong[dA]===dB){ score-=15; reasons.push(`æ—¥å¹²å†²ï¼š${dA}Ã—${dB} â†’ âˆ’15`); }
    if(wuxingGan[dA]===wuxingGan[dB]){ score+=5; reasons.push(`æ—¥ä¸»åŒäº”è¡Œï¼ˆä»·å€¼è§‚æ¥è¿‘ï¼‰â†’ +5`); }

    if(zhiHePairs.has(zA+zB)){ score+=10; reasons.push(`æ—¥æ”¯å…­åˆï¼š${zA}+${zB} â†’ +10`); }
    if(zhiChongPairs.has(zA+zB)){ score-=15; reasons.push(`æ—¥æ”¯å…­å†²ï¼š${zA}Ã—${zB} â†’ âˆ’15`); }

    const it=countInteractions(A,B);
    score += it.ganHe*3 + it.zhiHe*3;
    score -= it.ganChong*3 + it.zhiChong*4;

    const fav=favorTally(A,B);
    score += (fav.aGain+fav.bGain)*4;
    score -= (fav.aHitJi+fav.bHitJi)*4;

    const ax=analyzeXHP_San([...A.zhis,...B.zhis]);
    score -= ax.xing*3 + ax.hai*2 + ax.po*2;

    score=Math.max(0,Math.min(100,Math.round(score)));
    return {score, reasons:[...reasons, `åˆ/å†²ï¼šå¹²åˆ${it.ganHe} æ”¯åˆ${it.zhiHe}ï½œå¹²å†²${it.ganChong} æ”¯å†²${it.zhiChong}`, `åˆ‘å®³ç ´ï¼šåˆ‘${ax.xing} å®³${ax.hai} ç ´${ax.po}`], it, fav, ax};
  }
  function scoreCareer(A,B){
    let score=60, reasons=[];
    const it=countInteractions(A,B);
    score += it.ganHe*3 + it.zhiHe*2;
    score -= it.ganChong*4 + it.zhiChong*3;

    function side(wc){ const mf=wc.æœ¨+wc.ç«, tjs=wc.åœŸ+wc.é‡‘+wc.æ°´; return {mf,tjs}; }
    const Sa=side(A.sw.wc), Sb=side(B.sw.wc);
    if((Sa.mf>Sa.tjs && Sb.tjs>Sb.mf) || (Sa.tjs>Sa.mf && Sb.mf>Sb.tjs)){ score+=10; reasons.push('èŒèƒ½äº’è¡¥ï¼šä¸€åˆ›æ„ä¸€æ‰§è¡Œ â†’ +10'); }

    const fav=favorTally(A,B);
    score += (fav.aGain+fav.bGain)*5;
    score -= (fav.aHitJi+fav.bHitJi)*5;

    const ax=analyzeXHP_San([...A.zhis,...B.zhis]);
    score -= ax.xing*2 + ax.hai*1 + ax.po*1;

    const sanHelike = ax.sanhe.includes('ï¼ˆ') ? 1 : 0;
    const sanHuilike = ax.sanhui.includes('ï¼ˆ') ? 1 : 0;
    score += (sanHelike+sanHuilike)*3;

    score=Math.max(0,Math.min(100,Math.round(score)));
    return {score, reasons:[...reasons, `åˆ/å†²ï¼šå¹²åˆ${it.ganHe} æ”¯åˆ${it.zhiHe}ï½œå¹²å†²${it.ganChong} æ”¯å†²${it.zhiChong}`, `åˆ‘å®³ç ´ï¼šåˆ‘${ax.xing} å®³${ax.hai} ç ´${ax.po}`, (sanHelike||sanHuilike)?'ä¸‰åˆ/ä¸‰ä¼šåŠ©åŠ›ï¼šç»„ç»‡ååŒåŠ åˆ†':''], it, fav, ax};
  }

  // â€”â€” æ˜ç¡®çš„ç ´è§£ä¸è½åœ°å»ºè®® â€”â€” //
  function pick(arr){ return arr && arr.length ? arr[0] : null; }

  function buildActionable(type,A,B,calc){
    const list=[];
    const bothYong = [...new Set([...A.sw.yongSet].filter(x=>B.sw.yongSet.has(x)))];
    const bothJi   = [...new Set([...A.sw.jiSet].filter(x=>B.sw.jiSet.has(x)))];

    // 1) æ˜ç¡®å…ƒç´ 
    if(bothYong.length){
      const e = bothYong[0];
      const em = elementMonths[e];
      list.push(`ä¼˜å…ˆå…ƒç´ ï¼š${e}ï¼ˆå…±åŒå–œç”¨ï¼‰ã€‚`);
      if(em){
        list.push(`ã€æœˆä»½ã€‘${e}æœˆä»¤ï¼š${em.zhi.join(' / ')}ï¼›é˜³å†å‚è€ƒï¼š${em.greg[0]}ã€‚`);
        list.push(`ã€è¡Œä¸šã€‘ä¾§é‡ï¼š${em.jobs.join('ã€')}ã€‚`);
      }
    } else {
      const e = pick([...A.sw.yongSet]) || pick([...B.sw.yongSet]);
      if(e){
        const em = elementMonths[e];
        list.push(`ä¼˜å…ˆå…ƒç´ ï¼š${e}ï¼ˆå•æ–¹æ ¸å¿ƒå–œç”¨ï¼Œä¼˜å…ˆç”±å›¢é˜Ÿç¯å¢ƒæä¾›ï¼‰ã€‚`);
        if(em){
          list.push(`ã€æœˆä»½ã€‘${e}æœˆä»¤ï¼š${em.zhi.join(' / ')}ï¼›é˜³å†å‚è€ƒï¼š${em.greg[0]}ã€‚`);
          list.push(`ã€è¡Œä¸šã€‘å¯æ‹©ï¼š${em.jobs.join('ã€')}ã€‚`);
        }
      }
    }

    // 2) å¿Œç¥è§„é¿
    if(bothJi.length){
      const e = bothJi[0];
      const em = elementMonths[e];
      list.push(`è§„é¿å…ƒç´ ï¼š${e}ï¼ˆå…±åŒå¿Œç¥ï¼‰ã€‚`);
      if(em){
        list.push(`ã€é¿æœˆã€‘${em.zhi.join(' / ')}æœˆå°½é‡é¿å…åšç»ˆå±€æ€§å†³ç­–ï¼›æ”¹ä¸ºè¯•ç‚¹+é‡Œç¨‹ç¢‘å¼æ¨è¿›ã€‚`);
        list.push(`ã€é¿ä¸šã€‘å°‘æ¶‰ï¼š${em.jobs.join('ã€')} æˆ–ä»¥å¤–åŒ…/ç¬¬ä¸‰æ–¹éš”ç¦»é£é™©ã€‚`);
      }
    }

    // 3) åˆ‘/å®³/ç ´ä¸“å±ç ´è§£
    const ax = calc.ax;
    if(ax.xing>0) list.push(`æœ‰â€œåˆ‘â€ï¼šå›ºå®šåŒ–SOP + åŒå¤æ ¸ + ä¾‹å¤–å®¡æ‰¹ï¼›åˆ‘æœˆé¿å…ä¸å¯é€†å†³ç­–ã€‚`);
    if(ax.hai>0) list.push(`æœ‰â€œå®³â€ï¼šè®¾ç½®ä¿¡æ¯å¢™ä¸å†²çªæŠ«éœ²ï¼›å®³æœˆæŒ‰ä¹¦é¢æµç¨‹ç•™ç—•ï¼Œå‡å°‘è¯¯è§£ä¸å°äººã€‚`);
    if(ax.po>0)  list.push(`æœ‰â€œç ´â€ï¼šé‡‡ç”¨A/Bæµ‹è¯•ä¸çŸ­å†²åˆºï¼›ç ´æœˆä¸ç­¾é•¿æœŸä¸å¯è§£çº¦åˆåŒã€‚`);

    // 4) ä¸‰åˆ / ä¸‰ä¼š åŠ©åŠ›çš„åˆ©ç”¨
    const elemFromTxt = (txt)=>{ const m = txt.match(/ï¼ˆ(.+?)ï¼Œ/); return m?m[1]:null; };
    const shElem=elemFromTxt(ax.sanhe), shuiElem=elemFromTxt(ax.sanhui);
    const preferElem = shElem || shuiElem;
    if(preferElem && elementMonths[preferElem]){
      const em = elementMonths[preferElem];
      list.push(`ä¸‰åˆ/ä¸‰ä¼šåŠ©åŠ›ï¼šåå‘â€œ${preferElem}â€ã€‚`);
      list.push(`ã€æ‹©æ—¶ã€‘ä¼˜å…ˆåœ¨ ${em.zhi.join(' / ')} æœˆæ¨è¿›å…³é”®èŠ‚ç‚¹ï¼ˆé˜³å† ${em.greg[0]}ï¼‰ã€‚`);
      list.push(`ã€èµ„æºã€‘å¯¹æ¥ ${em.jobs.slice(0,4).join('ã€')} ç›¸å…³èµ„æº/åˆä½œæ–¹ã€‚`);
    }

    // 5) åˆ†å·¥/æ²Ÿé€š
    if(type==='career'){
      const Sa=A.sw.wc, Sb=B.sw.wc;
      const A_cre=(Sa.æœ¨+Sa.ç«)>(Sa.åœŸ+Sa.é‡‘+Sa.æ°´), B_cre=(Sb.æœ¨+Sb.ç«)>(Sb.åœŸ+Sb.é‡‘+Sb.æ°´);
      if(A_cre!==B_cre) list.push(`åˆ†å·¥ï¼šä¸€æ–¹ä¸»â€œå¤–â€ï¼ˆäº§å“/å¢é•¿/BD/å“ç‰Œï¼‰ï¼Œä¸€æ–¹ä¸»â€œå†…â€ï¼ˆäº¤ä»˜/é£æ§/è´¢æ§/æ³•åŠ¡ï¼‰ï¼›KPIåˆ†ç¦»ã€æƒè´£å¯¹ç­‰ã€‚`);
      else list.push(`åˆ†å·¥ï¼šä¾§é‡ç›¸è¿‘ï¼Œé‡‡ç”¨â€œèµ›é“åˆ†æ²»/åŒºåŸŸåˆ†è´¦â€ï¼Œå‡å°‘é‡å ä¸å†…è€—ã€‚`);
    }else{
      const dA=A.dayGan,dB=B.dayGan;
      if(ganChong[dA]===dB) list.push(`æ²Ÿé€šï¼šè®¾ç½®â€œæƒ…ç»ªæš‚åœâ€æš—å·+24å°æ—¶å†·é™æœŸï¼›é‡è¦è®®é¢˜ä½¿ç”¨ä¹¦é¢å…±è¯†æ¸…å•ã€‚`);
      if(ganHe[dA]===dB)   list.push(`é»˜å¥‘å¢å¹…ï¼šæ¯å‘¨ä¸€æ¬¡å›ºå®šâ€œå…±åŒé¡¹ç›®â€ï¼ˆè¯¾ç¨‹/æ—…è¡Œ/å®¶åº­é¡¹ç›®ï¼‰ï¼Œè®©åˆçš„èƒ½é‡è½åœ°ã€‚`);
    }

    // 6) æ€»ä½“æ‹©æœŸæŒ‡å¼•
    const yA=[...A.sw.yongSet], yB=[...B.sw.yongSet];
    const sel = (bothYong[0]) || (yA[0]) || (yB[0]);
    if(sel && elementMonths[sel]){
      const em = elementMonths[sel];
      list.push(`æ€»ä½“æ‹©æœŸï¼šä»¥â€œ${sel}â€ä¸ºä¸»è½´ï¼Œå…³é”®æ¨è¿›æ”¾åœ¨ ${em.zhi.join(' / ')}ï¼ˆé˜³å† ${em.greg[0]}ï¼‰ã€‚`);
    }
    return list;
  }

  // æ¸²æŸ“ï¼šåˆ‘/å®³/ç ´è¡¨
  function renderXHPTable(A,B){
    const tb = document.querySelector('#tabXingHaiPo tbody'); tb.innerHTML='';
    const Ares = analyzeXHP_San(A.zhis);
    const Bres = analyzeXHP_San(B.zhis);
    const Mres = analyzeXHP_San([...A.zhis,...B.zhis]);
    [ ['A',Ares], ['B',Bres], ['åˆç›˜',Mres] ].forEach(([lab,res])=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${lab}</td><td>${res.xing}</td><td>${res.hai}</td><td>${res.po}</td><td>${res.sanhe}</td><td>${res.sanhui}</td><td>${res.explain}</td>`;
      tb.appendChild(tr);
    });

    const expl = [];
    expl.push('ã€åè¯è§£é‡Šã€‘');
    expl.push('Â· åˆ‘ï¼šè§„åˆ™/æ€§æ ¼å¯¹æ’ï¼Œæ˜“å†…è€—ä¸çº ç»“ï¼ˆå¯…å·³ç”³ã€ä¸‘æœªæˆŒã€å­å¯ï¼›è¾°/åˆ/é…‰/äº¥è‡ªåˆ‘ï¼‰ã€‚');
    expl.push('Â· å®³ï¼šæš—ä¸­æ£è‚˜ã€å°äººã€è¯¯è§£æˆæœ¬å‡é«˜ï¼ˆå¦‚å­æœªã€ä¸‘åˆã€ç”³äº¥ç­‰ï¼‰ã€‚');
    expl.push('Â· ç ´ï¼šç ´å/æ‹†å°ï¼Œé€‚åˆçŸ­å‘¨æœŸè¯•é”™ï¼Œä¸å®œç»ˆå±€æ€§å†³ç­–ã€‚');
    expl.push('Â· ä¸‰åˆ/ä¸‰ä¼šï¼šåŒæ°”ç›¸æ±‚/æˆå±€åŠ©åŠ›ï¼Œåˆ©äºç»„ç»‡ååŒä¸èµ„æºæ•´åˆã€‚');
    document.getElementById('txtXhpExplain').textContent=expl.join('\n');
  }

  // æ¸²æŸ“åˆç›˜
  function renderCompat(type,A,B,calc){
    document.getElementById('panelCompat').style.display='block';
    document.getElementById('compatType').textContent = type==='career' ? 'ï¼ˆäº‹ä¸šè´¢è¿ï¼‰' : 'ï¼ˆå©šå§»ï¼‰';

    const kpiC=document.getElementById('kpiC'); kpiC.innerHTML='';
    const bothYong=[...new Set([...A.sw.yongSet].filter(x=>B.sw.yongSet.has(x)))];
    const bothJi=[...new Set([...A.sw.jiSet].filter(x=>B.sw.jiSet.has(x)))];
    const score=calc.score;
    [
      ['æ€»è¯„åˆ†', score+'/100'],
      ['Aæ—¥ä¸»', A.dayGan+'ï¼ˆ'+A.dayElement+'ï¼›'+A.sw.strongWeak+'ï¼‰'],
      ['Bæ—¥ä¸»', B.dayGan+'ï¼ˆ'+B.dayElement+'ï¼›'+B.sw.strongWeak+'ï¼‰'],
      ['å…±åŒå–œç”¨', bothYong.join('ã€')||'â€”'],
      ['å…±åŒå¿Œç¥', bothJi.join('ã€')||'â€”'],
      ['åˆ/å†²ï¼ˆæƒé‡ï¼‰', `å¹²åˆ${calc.it.ganHe} æ”¯åˆ${calc.it.zhiHe}ï½œå¹²å†²${calc.it.ganChong} æ”¯å†²${calc.it.zhiChong}`]
    ].forEach(([k,v])=>{
      const el=document.createElement('div'); el.className='kpi'; el.innerHTML=`<h3>${k}</h3><div>${v}</div>`; kpiC.appendChild(el);
    });

    const txt=[];
    txt.push(`æ ¸å¿ƒä¾æ®ï¼šæ—¥ä¸»å…³ç³»ã€å››æŸ±åˆ/å†²ã€åˆ‘/å®³/ç ´ã€å–œç”¨äº’è¡¥/å¿Œç¥äº’è¸©ã€ä¸‰åˆ/ä¸‰ä¼šåŠ©åŠ›ã€èŒèƒ½äº’è¡¥ã€‚`);
    calc.reasons.filter(Boolean).forEach((r,i)=>txt.push(`${i+1}. ${r}`));
    txt.push('');
    txt.push(`Aå–œç”¨ï¼š${[...A.sw.yongSet].join('ã€')}ï¼›Aå¿Œç¥ï¼š${[...A.sw.jiSet].join('ã€')}`);
    txt.push(`Bå–œç”¨ï¼š${[...B.sw.yongSet].join('ã€')}ï¼›Bå¿Œç¥ï¼š${[...B.sw.jiSet].join('ã€')}`);
    document.getElementById('txtCompat').textContent=txt.join('\n');

    renderXHPTable(A,B);

    const advUl=document.getElementById('adviceList'); advUl.innerHTML='';
    buildActionable(type,A,B,calc).forEach(s=>{
      const li=document.createElement('li'); li.textContent=s; advUl.appendChild(li);
    });
  }

  // äº‹ä»¶
  let A=null,B=null;
  document.getElementById('btnA').addEventListener('click', ()=>{ A=genChart('A'); });
  document.getElementById('btnB').addEventListener('click', ()=>{ B=genChart('B'); });
  document.getElementById('btnCareer').addEventListener('click', ()=>{
    if(!A) A=genChart('A'); if(!B) B=genChart('B'); if(!(A&&B)) return;
    const calc=scoreCareer(A,B); renderCompat('career',A,B,calc);
  });
  document.getElementById('btnMarriage').addEventListener('click', ()=>{
    if(!A) A=genChart('A'); if(!B) B=genChart('B'); if(!(A&&B)) return;
    const calc=scoreMarriage(A,B); renderCompat('marriage',A,B,calc);
  });
  // è¿è¡Œç¤ºä¾‹ï¼ˆå†…å»ºæµ‹è¯•ï¼‰
  document.getElementById('btnTest').addEventListener('click', ()=>{
    const st=document.getElementById('engineStatus'); st.textContent='æ’ç›˜å¼•æ“ï¼šæµ‹è¯•ä¸­â€¦'; st.classList.remove('green','red'); st.classList.add('orange');
    try{
      if(!window.Solar||!window.Lunar) throw new Error('å¼•æ“æœªåŠ è½½');
      const Atest={y:1990,m:1,d:1,h:12}, Btest={y:1992,m:6,d:10,h:8};
      document.getElementById('Ayear').value=Atest.y; document.getElementById('Amonth').value=Atest.m; document.getElementById('Aday').value=Atest.d; document.getElementById('Ahour').value=Atest.h;
      document.getElementById('Byear').value=Btest.y; document.getElementById('Bmonth').value=Btest.m; document.getElementById('Bday').value=Btest.d; document.getElementById('Bhour').value=Btest.h;
      A=genChart('A'); B=genChart('B');
      const mc=scoreMarriage(A,B), cc=scoreCareer(A,B);
      renderCompat('marriage',A,B,mc);
      alert(['âœ… Solar.fromYmdHms å¯ç”¨ï¼›A/B æ’ç›˜å°±ç»ª','âœ… å©šå§»è¯„åˆ†ï¼š'+mc.score,'âœ… äº‹ä¸šè¯„åˆ†ï¼š'+cc.score].join('\n'));
      st.textContent='æ’ç›˜å¼•æ“ï¼šlunar-javascriptï¼ˆå·²å°±ç»ªï¼‰'; st.classList.remove('orange'); st.classList.add('green');
    }catch(e){
      st.textContent='æ’ç›˜å¼•æ“ï¼šlunar-javascriptï¼ˆåŠ è½½å¤±è´¥ï¼‰'; st.classList.remove('orange'); st.classList.add('red');
      alert('âŒ ç¤ºä¾‹è¿è¡Œå¤±è´¥ï¼š'+e.message+'\nè¯·æ£€æŸ¥ç½‘ç»œæ˜¯å¦èƒ½åŠ è½½ CDNã€‚');
    }
  });
</script>
</body>
</html>
